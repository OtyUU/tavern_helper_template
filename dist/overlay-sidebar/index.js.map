{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/src/overlay-sidebar/utils.ts","src://tavern_helper_template/src/overlay-sidebar/notes-storage.ts","src://tavern_helper_template/src/overlay-sidebar/sidebar-logic.ts","src://tavern_helper_template/src/util/script.ts","src://tavern_helper_template/src/overlay-sidebar/variables-integration.ts","src://tavern_helper_template/src/overlay-sidebar/加载和卸载时执行函数.ts","src://tavern_helper_template/src/overlay-sidebar/index.ts"],"sourcesContent":["// Utility functions for overlay sidebar script\n\ndeclare global {\n  interface Window {\n    toastr?: {\n      success: (message: string, title?: string) => void;\n      error: (message: string, title?: string) => void;\n      warning: (message: string, title?: string) => void;\n      info: (message: string, title?: string) => void;\n    };\n    SillyTavern?: {\n      getCurrentChatId(): number;\n    };\n    sidebarDebug?: boolean;\n  }\n}\n\n/**\n * Console-only notification system that logs to console with appropriate levels\n * This function never shows UI notifications (toastr/alerts)\n */\nexport function showNotification(\n  message: string,\n  type: 'success' | 'error' | 'warning' | 'info' = 'info',\n  title?: string,\n): void {\n  // Always log to console with [Tavern Helper] prefix for consistency\n  const prefix = '[Tavern Helper]';\n  const titlePart = title ? `${title}: ` : '';\n  const fullMessage = `${prefix} ${titlePart}${message}`;\n\n  // Map notification type to appropriate console method\n  switch (type) {\n    case 'success':\n      console.log(fullMessage);\n      break;\n    case 'error':\n      console.error(fullMessage);\n      break;\n    case 'warning':\n      console.warn(fullMessage);\n      break;\n    case 'info':\n    default:\n      console.log(fullMessage);\n      break;\n  }\n}\n\n/**\n * Safe selector utility that handles jQuery selection safely\n * Returns null if selector fails or jQuery is not available\n */\nexport function querySafe(selector: string, context?: JQuery | Element | Document): JQuery | null {\n  if (typeof $ === 'undefined') {\n    console.warn('[Sidebar] jQuery not available for selector:', selector);\n    return null;\n  }\n\n  try {\n    const result = context ? $(selector, context) : $(selector);\n    if (result.length === 0) {\n      if (window.sidebarDebug) {\n        console.debug(`[Sidebar] Selector didn't match any elements: ${selector}`);\n      }\n      return null;\n    }\n    return result;\n  } catch (error) {\n    console.error('[Sidebar] Selector error:', selector, error);\n    return null;\n  }\n}\n\n/**\n * Event utility system for safely binding and unbinding events\n */\nexport const eventUtils = {\n  /**\n   * Safe event binding with jQuery fallback\n   */\n  on(\n    element: string | JQuery | Element | Document,\n    eventType: string,\n    handler: (event: JQuery.Event) => void,\n    context?: any,\n  ): void {\n    if (typeof $ === 'undefined') {\n      console.warn('[Sidebar] jQuery not available for event binding:', eventType);\n      return;\n    }\n\n    try {\n      const $element = typeof element === 'string' ? $(element) : $(element);\n      if ($element.length === 0) {\n        console.warn('[Sidebar] Event target not found:', element);\n        return;\n      }\n\n      if (context) {\n        $element.on(eventType, context, handler);\n      } else {\n        $element.on(eventType, handler);\n      }\n\n      if (window.sidebarDebug) {\n        console.debug(`[Sidebar] Event bound: ${eventType} on`, element);\n      }\n    } catch (error) {\n      console.error('[Sidebar] Event binding error:', eventType, error);\n    }\n  },\n\n  /**\n   * Safe event unbinding\n   */\n  off(\n    element: string | JQuery | Element | Document,\n    eventType?: string,\n    handler?: (event: JQuery.Event) => void,\n  ): void {\n    if (typeof $ === 'undefined') return;\n\n    try {\n      const $element = typeof element === 'string' ? $(element) : $(element);\n      if ($element.length === 0) return;\n\n      if (eventType && handler) {\n        $element.off(eventType, handler);\n      } else if (eventType) {\n        $element.off(eventType);\n      } else {\n        $element.off();\n      }\n\n      if (window.sidebarDebug) {\n        console.debug(`[Sidebar] Event unbound: ${eventType || 'all'} on`, element);\n      }\n    } catch (error) {\n      console.error('[Sidebar] Event unbinding error:', eventType, error);\n    }\n  },\n\n  /**\n   * One-time event binding\n   */\n  once(element: string | JQuery | Element | Document, eventType: string, handler: (event: JQuery.Event) => void): void {\n    if (typeof $ === 'undefined') {\n      console.warn('[Sidebar] jQuery not available for event binding:', eventType);\n      return;\n    }\n\n    try {\n      const $element = typeof element === 'string' ? $(element) : $(element);\n      if ($element.length === 0) {\n        console.warn('[Sidebar] Event target not found:', element);\n        return;\n      }\n\n      $element.one(eventType, handler);\n\n      if (window.sidebarDebug) {\n        console.debug(`[Sidebar] One-time event bound: ${eventType} on`, element);\n      }\n    } catch (error) {\n      console.error('[Sidebar] Event binding error:', eventType, error);\n    }\n  },\n};\n\n/**\n * Dependency checker for required globals\n */\nexport function checkDependencies(\n  dependencies: Array<'jQuery' | 'localStorage' | 'replaceScriptButtons' | 'eventOn' | 'getButtonEvent'>,\n): Record<string, boolean> {\n  const results: Record<string, boolean> = {};\n  const missing: string[] = [];\n\n  for (const dep of dependencies) {\n    let available = false;\n    switch (dep) {\n      case 'jQuery':\n        available = typeof $ !== 'undefined';\n        break;\n      case 'localStorage':\n        available = typeof localStorage !== 'undefined';\n        break;\n      case 'replaceScriptButtons':\n        available = typeof (window as any).replaceScriptButtons === 'function';\n        break;\n      case 'eventOn':\n        available = typeof (window as any).eventOn === 'function';\n        break;\n      case 'getButtonEvent':\n        available = typeof (window as any).getButtonEvent === 'function';\n        break;\n    }\n\n    results[dep] = available;\n    if (!available) missing.push(dep);\n  }\n\n  if (missing.length > 0) {\n    console.warn('[Sidebar] Missing dependencies:', missing.join(', '));\n    if (window.sidebarDebug) {\n      console.groupCollapsed('[Sidebar] Dependency check details');\n      console.table(results);\n      console.groupEnd();\n    }\n  } else if (window.sidebarDebug) {\n    console.debug('[Sidebar] All dependencies available');\n  }\n\n  return results;\n}\n\n/**\n * Safe version of replaceScriptButtons with fallback\n */\nexport function safeReplaceScriptButtons(\n  buttons: Array<{ name: string; visible: boolean; onclick?: () => void }>,\n  fallbackAction?: () => void,\n): boolean {\n  if (typeof (window as any).replaceScriptButtons === 'function') {\n    try {\n      (window as any).replaceScriptButtons(buttons);\n      console.log('[Sidebar] Script buttons replaced:', buttons.map(b => b.name).join(', '));\n      return true;\n    } catch (error) {\n      console.error('[Sidebar] replaceScriptButtons error:', error);\n      // Execute fallback if provided\n      if (fallbackAction) {\n        console.log('[Sidebar] Executing fallback action');\n        fallbackAction();\n      }\n      return false;\n    }\n  }\n\n  console.warn('[Sidebar] replaceScriptButtons not available');\n  if (fallbackAction) {\n    console.log('[Sidebar] Executing fallback action');\n    fallbackAction();\n  }\n  return false;\n}\n\n/**\n * Safe version of eventOn with fallback\n */\nexport function safeEventOn(eventName: string, handler: () => void, fallbackAction?: () => void): boolean {\n  if (typeof (window as any).eventOn === 'function') {\n    try {\n      (window as any).eventOn(eventName, handler);\n      console.log('[Sidebar] Event handler registered:', eventName);\n      return true;\n    } catch (error) {\n      console.error('[Sidebar] eventOn error:', error);\n      // Execute fallback if provided\n      if (fallbackAction) {\n        console.log('[Sidebar] Executing fallback action');\n        fallbackAction();\n      }\n      return false;\n    }\n  }\n\n  console.warn('[Sidebar] eventOn not available');\n  if (fallbackAction) {\n    console.log('[Sidebar] Executing fallback action');\n    fallbackAction();\n  }\n  return false;\n}\n\n/**\n * Safe version of getButtonEvent with fallback\n */\nexport function safeGetButtonEvent(buttonName: string, fallbackEventName?: string): string | null {\n  if (typeof (window as any).getButtonEvent === 'function') {\n    try {\n      const eventName = (window as any).getButtonEvent(buttonName);\n      console.log('[Sidebar] Button event retrieved:', buttonName, '->', eventName);\n      return eventName;\n    } catch (error) {\n      console.error('[Sidebar] getButtonEvent error:', error);\n      return fallbackEventName || null;\n    }\n  }\n\n  console.warn('[Sidebar] getButtonEvent not available');\n  return fallbackEventName || null;\n}\n\n/**\n * Storage key generation improvements with chat isolation\n */\nexport function generateStorageKey(prefix: string = 'tavern_helper_quick_notes'): string {\n  let chatId = 'global';\n\n  // Try to get chat ID from SillyTavern\n  if (window.SillyTavern && typeof window.SillyTavern.getCurrentChatId === 'function') {\n    try {\n      const id = window.SillyTavern.getCurrentChatId();\n      if (id !== undefined && id !== null) {\n        chatId = `chat_${id}`;\n      }\n    } catch (error) {\n      console.warn('[Sidebar] Failed to get chat ID:', error);\n    }\n  }\n\n  // Add user session identifier for additional isolation\n  const sessionId = sessionStorage.getItem('tavern_helper_session') || 'default';\n\n  return `${prefix}_${chatId}_${sessionId}`;\n}\n\nexport default {\n  showNotification,\n  querySafe,\n  eventUtils,\n  checkDependencies,\n  safeReplaceScriptButtons,\n  safeEventOn,\n  safeGetButtonEvent,\n  generateStorageKey,\n};\n","// Notes storage functionality for overlay sidebar\nimport { generateStorageKey, querySafe } from './utils';\n\ndeclare global {\n  interface Window {\n    SillyTavern?: {\n      getCurrentChatId(): number;\n    };\n    saveCurrentNotes?(): void;\n    saveCurrentOCC?(): void;\n    loadNotes?(): string;\n    syncNotesToVariable?(content: string): void;\n  }\n}\n\nfunction getStorageKey(): string {\n  // Use improved key generation with chat isolation\n  return generateStorageKey();\n}\n\nfunction getOCCStorageKey(): string {\n  // Use different prefix for OCC notes\n  return generateStorageKey('tavern_helper_occ_notes');\n}\n\nexport function saveNotes(content: string): void {\n  try {\n    const storageKey = getStorageKey();\n    localStorage.setItem(storageKey, content);\n    console.log(`[Tavern Helper] Notes saved for ${storageKey}, length: ${content.length}`);\n    // Sync to tavern variable system for macro accessibility\n    if (typeof (window as any).syncNotesToVariable === 'function') {\n      (window as any).syncNotesToVariable(content);\n    }\n    console.log(`[Tavern Helper] Variable sync attempted`);\n  } catch (e) {\n    console.error('[Tavern Helper] Failed to save notes:', e);\n  }\n}\n\nexport function saveOCCNotes(content: string): void {\n  try {\n    const storageKey = getOCCStorageKey();\n    localStorage.setItem(storageKey, content);\n    console.log(`[Tavern Helper] OCC notes saved for ${storageKey}, length: ${content.length}`);\n    // Sync to tavern variable system for macro accessibility\n    if (typeof (window as any).syncOCCToVariable === 'function') {\n      (window as any).syncOCCToVariable(content);\n    }\n    // Log success to console instead of showing UI notification\n    console.log('[Tavern Helper] OCC Notes: OCC notes saved successfully!');\n    console.log(`[Tavern Helper] OCC variable sync completed`);\n  } catch (e) {\n    console.error('[Tavern Helper] Failed to save OCC notes:', e);\n    // Log error to console instead of showing UI notification\n    console.error('[Tavern Helper] OCC Notes: Failed to save OCC notes');\n  }\n}\n\nexport function loadNotes(): string {\n  try {\n    const storageKey = getStorageKey();\n    const content = localStorage.getItem(storageKey) || '';\n    console.log(`[Tavern Helper] Notes loaded for ${storageKey}, length: ${content.length}`);\n    return content;\n  } catch (e) {\n    console.error('[Tavern Helper] Failed to load notes:', e);\n    return '';\n  }\n}\n\nexport function loadOCCNotes(): string {\n  try {\n    const storageKey = getOCCStorageKey();\n    const content = localStorage.getItem(storageKey) || '';\n    console.log(`[Tavern Helper] OCC notes loaded for ${storageKey}, length: ${content.length}`);\n    return content;\n  } catch (e) {\n    console.error('[Tavern Helper] Failed to load OCC notes:', e);\n    return '';\n  }\n}\n\nexport function clearNotes(): void {\n  try {\n    localStorage.removeItem(getStorageKey());\n    console.log(`[Tavern Helper] Notes cleared for ${getStorageKey()}`);\n  } catch (e) {\n    console.error('[Tavern Helper] Failed to clear notes:', e);\n  }\n}\n\nexport function clearOCCNotes(): void {\n  try {\n    localStorage.removeItem(getOCCStorageKey());\n    console.log(`[Tavern Helper] OCC notes cleared for ${getOCCStorageKey()}`);\n  } catch (e) {\n    console.error('[Tavern Helper] Failed to clear OCC notes:', e);\n  }\n}\n\n// Auto-save configuration\nexport interface AutoSaveConfig {\n  enabled: boolean;\n  delay: number; // milliseconds\n}\n\n// Default configuration\nexport const DEFAULT_AUTO_SAVE_CONFIG: AutoSaveConfig = {\n  enabled: true,\n  delay: 1000, // 1 second\n};\n\nlet autoSaveTimeout: number | null = null;\nlet occAutoSaveTimeout: number | null = null;\nlet currentConfig: AutoSaveConfig = { ...DEFAULT_AUTO_SAVE_CONFIG };\n\n// Update configuration\nexport function configureAutoSave(config: Partial<AutoSaveConfig>): void {\n  currentConfig = { ...DEFAULT_AUTO_SAVE_CONFIG, ...config };\n  console.log(\n    `[Tavern Helper] Auto-save configured: ${currentConfig.enabled ? 'enabled' : 'disabled'} with ${currentConfig.delay}ms delay`,\n  );\n\n  // Clear any pending timeout if disabled\n  if (!currentConfig.enabled && autoSaveTimeout) {\n    clearTimeout(autoSaveTimeout);\n    autoSaveTimeout = null;\n  }\n}\n\n// Core auto-save functionality\nexport function setupAutoSave(): void {\n  $(document).on('input', '#tavern-helper-notes', function () {\n    if (!currentConfig.enabled) return;\n\n    // Immediate sync to tavern variables for macro accessibility\n    const content = $(this).val() as string;\n    if (typeof (window as any).syncNotesToVariable === 'function') {\n      (window as any).syncNotesToVariable(content);\n    }\n    console.log(`[Tavern Helper] Immediate variable sync (${content.length} chars)`);\n\n    // Debounced localStorage save for performance\n    if (autoSaveTimeout) {\n      clearTimeout(autoSaveTimeout);\n    }\n    autoSaveTimeout = window.setTimeout(() => {\n      saveNotes(content);\n      console.log(`[Tavern Helper] Auto-saved notes to localStorage (${content.length} chars)`);\n    }, currentConfig.delay);\n  });\n\n  // Separate listener for OCC textarea\n  $(document).on('input', '#tavern-helper-occ', function () {\n    if (!currentConfig.enabled) return;\n\n    const content = $(this).val() as string;\n    // Immediate sync to OCC variable\n    if (typeof (window as any).syncOCCToVariable === 'function') {\n      (window as any).syncOCCToVariable(content);\n    }\n    console.log(`[Tavern Helper] Immediate OCC variable sync (${content.length} chars)`);\n\n    // Debounced localStorage save for OCC\n    if (occAutoSaveTimeout) {\n      clearTimeout(occAutoSaveTimeout);\n    }\n    occAutoSaveTimeout = window.setTimeout(() => {\n      saveOCCNotes(content);\n      console.log(`[Tavern Helper] Auto-saved OCC notes to localStorage (${content.length} chars)`);\n    }, currentConfig.delay);\n  });\n}\n\n// Manual trigger for auto-save (e.g., before unload)\nexport function triggerAutoSave(): void {\n  if (autoSaveTimeout) {\n    clearTimeout(autoSaveTimeout);\n    autoSaveTimeout = null;\n  }\n  // Use safe selector to avoid errors if element doesn't exist\n  const notesElement = querySafe('#tavern-helper-notes');\n  const content = notesElement ? (notesElement.val() as string) : '';\n  saveNotes(content);\n}\n\n// Cleanup auto-save\nexport function cleanupAutoSave(): void {\n  if (autoSaveTimeout) {\n    clearTimeout(autoSaveTimeout);\n    autoSaveTimeout = null;\n  }\n  if (occAutoSaveTimeout) {\n    clearTimeout(occAutoSaveTimeout);\n    occAutoSaveTimeout = null;\n  }\n}\n\n// Export global functions\nwindow.saveCurrentNotes = function () {\n  console.log('[Tavern Helper] Manual save triggered');\n  const content = $('#tavern-helper-notes').val() as string;\n  console.log(`[Tavern Helper] Saving content length: ${content.length}`);\n  saveNotes(content);\n  // Log to console instead of showing UI notification\n  console.log('[Tavern Helper] Quick Notes: Notes saved successfully!');\n};\n\nwindow.saveCurrentOCC = function () {\n  console.log('[Tavern Helper] Manual OCC save triggered');\n  const content = $('#tavern-helper-occ').val() as string;\n  console.log(`[Tavern Helper] Saving OCC content length: ${content.length}`);\n  saveOCCNotes(content);\n  // Notification already logged in saveOCCNotes\n};\n\nwindow.loadNotes = function () {\n  return loadNotes();\n};\n","// Sidebar logic for overlay sidebar\nimport { deteleportStyle, teleportStyle } from '../util/script';\nimport { eventUtils, querySafe } from './utils';\n\n// Configuration constants for sidebar appearance\nconst SIDEBAR_WIDTH = '500px'; // Default width, can be modified here\nconst SIDEBAR_ID = 'tavern-helper-overlay-sidebar';\n\ndeclare global {\n  interface Window {\n    toggleSidebar: () => void;\n    hideSidebar: () => void;\n    showSidebar: () => void;\n    saveCurrentNotes?: () => void;\n    loadNotes?: () => string;\n    // Debug functions\n    testSidebarButton?: () => boolean;\n    enableSidebarDebug?: (verbose?: boolean) => void;\n    sidebarDebug?: boolean;\n    // Additional properties from other modules\n    tavern_helper?: {\n      registerVariable?(\n        name: string,\n        config: {\n          get: () => any;\n          set?: (value: any) => void;\n          description?: string;\n        },\n      ): void;\n    };\n    triggerAutoSave?: () => void;\n  }\n}\n\nlet sidebarVisible = false;\n\nfunction injectCSS(): void {\n  const css = `\n        .tavern-helper-overlay-sidebar {\n            position: fixed;\n            top: 0;\n            right: 0;\n            width: ${SIDEBAR_WIDTH};\n            height: 100vh;\n            background: rgba(29, 33, 40, 0.9);\n            backdrop-filter: blur(0px);\n            border-left: 0.5px solid rgba(0, 0, 0, 0.5);\n            border-top-left-radius: 12px;\n            border-bottom-left-radius: 12px;\n            z-index: 999999;\n            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n            transform: translateX(100%);\n            padding: 0;\n            color: rgba(207, 207, 197, 1);\n            overflow: hidden;\n            box-shadow: -1px 0 0 rgba(0, 0, 0, 0.5);\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;\n            display: flex;\n            flex-direction: column;\n        }\n\n        .tavern-helper-overlay-sidebar.visible {\n            transform: translateX(0);\n        }\n\n        .tavern-helper-overlay-sidebar .header {\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            padding: 0 20px;\n            height: 40px;\n            background: rgba(29, 33, 40, 0.95);\n            border-bottom: 0.5px solid rgba(0, 0, 0, 0.8);\n            border-top-left-radius: 12px;\n            backdrop-filter: blur(0px);\n            flex-shrink: 0;\n        }\n\n        .tavern-helper-overlay-sidebar .header-title {\n            display: flex;\n            align-items: center;\n            gap: 10px;\n        }\n\n        .tavern-helper-overlay-sidebar .header-icon {\n            width: 20px;\n            height: 20px;\n            opacity: 0.7;\n            color: rgba(207, 207, 197, 0.8);\n        }\n\n        .tavern-helper-overlay-sidebar .header h3 {\n            margin: 0;\n            font-size: 15px;\n            font-weight: 500;\n            letter-spacing: 0.3px;\n            color: rgba(207, 207, 197, 1);\n        }\n\n        .tavern-helper-overlay-sidebar .close-btn {\n            background: rgba(29, 33, 40, 0.6);\n            border: 0.5px solid rgba(0, 0, 0, 0.8);\n            color: rgba(207, 207, 197, 0.9);\n            cursor: pointer;\n            padding: 6px 10px;\n            border-radius: 8px;\n            font-size: 18px;\n            line-height: 1;\n            transition: all 0.2s ease;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            min-width: 32px;\n            height: 32px;\n        }\n\n        .tavern-helper-overlay-sidebar .close-btn:hover {\n            background: rgba(40, 45, 52, 0.8);\n            border-color: rgba(0, 0, 0, 0.9);\n            color: rgba(237, 234, 234, 1);\n        }\n\n        .tavern-helper-overlay-sidebar .close-btn:active {\n            transform: scale(0.95);\n        }\n\n        .tavern-helper-overlay-sidebar .content {\n            display: flex;\n            flex-direction: column;\n            flex: 1;\n            padding: 20px;\n            overflow: hidden;\n            gap: 10px;\n        }\n\n        .tavern-helper-overlay-sidebar textarea {\n            width: 100%;\n            background: rgba(29, 33, 40, 0.88);\n            border: 0.5px solid rgba(0, 0, 0, 0.8);\n            color: rgba(207, 207, 197, 1);\n            padding: 14px;\n            border-radius: 10px;\n            font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;\n            resize: none;\n            font-size: 13.5px;\n            line-height: 1.6;\n            transition: all 0.2s ease;\n        }\n\n        .tavern-helper-overlay-sidebar textarea#tavern-helper-notes {\n            flex: 1; /* ~70% */\n            min-height: 180px;\n        }\n\n        .tavern-helper-overlay-sidebar textarea#tavern-helper-occ {\n            flex: 0.15; /* ~30% */\n            min-height: 60px;\n        }\n\n        .tavern-helper-overlay-sidebar textarea:focus {\n            outline: none;\n            border-color: rgb(92, 94, 100);\n            background: rgba(29, 33, 40, 0.95);\n            box-shadow: none;\n        }\n\n        .tavern-helper-overlay-sidebar textarea::placeholder {\n            color: rgba(145, 145, 145, 1);\n            font-style: italic;\n        }\n\n        .tavern-helper-overlay-sidebar textarea::-webkit-scrollbar {\n            width: 8px;\n        }\n\n        .tavern-helper-overlay-sidebar textarea::-webkit-scrollbar-track {\n            background: rgba(0, 0, 0, 0.3);\n            border-radius: 4px;\n        }\n\n        .tavern-helper-overlay-sidebar textarea::-webkit-scrollbar-thumb {\n            background: rgba(60, 65, 72, 0.8);\n            border-radius: 4px;\n            transition: background 0.2s ease;\n        }\n\n        .tavern-helper-overlay-sidebar textarea::-webkit-scrollbar-thumb:hover {\n            background: rgba(80, 85, 92, 1);\n        }\n    `;\n\n  $('<style>').text(css).appendTo('head');\n  teleportStyle();\n}\n\nfunction injectHTML(): void {\n  if (querySafe(`#${SIDEBAR_ID}`)?.length ?? 0 > 0) {\n    return;\n  }\n\n  // SVG icon for notes (matches SillyTavern's icon style)\n  const noteIcon = `<svg class=\"header-icon\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n        <path d=\"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z\"></path>\n        <polyline points=\"14 2 14 8 20 8\"></polyline>\n        <line x1=\"16\" y1=\"13\" x2=\"8\" y2=\"13\"></line>\n        <line x1=\"16\" y1=\"17\" x2=\"8\" y2=\"17\"></line>\n        <polyline points=\"10 9 9 9 8 9\"></polyline>\n    </svg>`;\n\n  const html = `\n        <div id=\"${SIDEBAR_ID}\" class=\"tavern-helper-overlay-sidebar\">\n            <div class=\"header\">\n                <div class=\"header-title\">\n                    ${noteIcon}\n                    <h3>Quick Notes</h3>\n                </div>\n                <button class=\"close-btn\" onclick=\"window.hideSidebar()\" title=\"Close (Esc)\">×</button>\n            </div>\n            <div class=\"content\">\n                <textarea id=\"tavern-helper-notes\" placeholder=\"Take your quick notes here...\\n\\nSaved automatically when you close the sidebar.\" spellcheck=\"true\"></textarea>\n                <textarea id=\"tavern-helper-occ\" placeholder=\"Out of character (OCC)\" spellcheck=\"true\"></textarea>\n            </div>\n        </div>\n    `;\n\n  $(html).appendTo('body');\n}\n\nfunction setupEventListeners(): void {\n  // Setup close button via event delegation using safe selector\n  eventUtils.on(`#${SIDEBAR_ID} .close-btn`, 'click', hideSidebar);\n\n  // Save on textarea blur (immediate save) with error handling\n  eventUtils.on('#tavern-helper-notes', 'blur', function () {\n    const debug = (window as any).sidebarDebug;\n    if (debug) {\n      console.debug('[Tavern Helper] Textarea blur detected');\n    }\n\n    try {\n      if (typeof window.saveCurrentNotes === 'function') {\n        window.saveCurrentNotes();\n        if (debug) {\n          console.info('[Tavern Helper] Auto-saved on blur');\n        }\n      }\n    } catch (e) {\n      console.warn('[Tavern Helper] Blur save error:', e);\n    }\n    // Also trigger auto-save immediately\n    if (typeof (window as any).triggerAutoSave === 'function') {\n      (window as any).triggerAutoSave();\n    }\n  });\n\n  // Save on OCC textarea blur\n  eventUtils.on('#tavern-helper-occ', 'blur', function (this: HTMLElement) {\n    const debug = (window as any).sidebarDebug;\n    if (debug) {\n      console.debug('[Tavern Helper] OCC textarea blur detected');\n    }\n    try {\n      // Save OCC notes if saveCurrentOCC function exists\n      if (typeof (window as any).saveCurrentOCC === 'function') {\n        (window as any).saveCurrentOCC();\n      } else {\n        // Fallback: save via storage API\n        const content = $(this).val() as string;\n        (window as any).saveOCCNotes?.(content);\n      }\n    } catch (e) {\n      console.warn('[Tavern Helper] OCC blur save error:', e);\n    }\n  });\n\n  // Escape key to close sidebar\n  eventUtils.on(document, 'keydown', function (e: JQuery.Event) {\n    if (e.key === 'Escape' && sidebarVisible) {\n      console.log('[Tavern Helper] Escape key pressed, closing sidebar');\n      hideSidebar();\n    }\n  });\n}\n\nexport function toggleSidebar(): void {\n  const debug = (window as any).sidebarDebug;\n\n  console.groupCollapsed(`[Tavern Helper] toggleSidebar called, current visibility: ${sidebarVisible}`);\n  console.info('Action:', sidebarVisible ? 'Hiding' : 'Showing');\n  if (debug) {\n    console.debug('Full state:', { sidebarVisible, SIDEBAR_ID });\n  }\n\n  sidebarVisible = !sidebarVisible;\n  const sidebar = querySafe(`#${SIDEBAR_ID}`);\n\n  sidebar?.toggleClass('visible', sidebarVisible);\n  console.log(`[Tavern Helper] Sidebar visibility set to: ${sidebarVisible}`);\n\n  if (sidebarVisible) {\n    // Focus main textarea when showing with slight delay for DOM ready\n    setTimeout(() => {\n      const textarea = querySafe('#tavern-helper-notes');\n      if (textarea?.length) {\n        textarea.trigger('focus');\n        console.info('[Tavern Helper] Textarea focused');\n      } else {\n        console.warn('[Tavern Helper] Textarea not found for focus');\n      }\n    }, 100);\n\n    // Load saved notes with safety check\n    if (typeof window.loadNotes === 'function') {\n      const notes = window.loadNotes();\n      const textarea = querySafe('#tavern-helper-notes');\n      textarea?.val(notes);\n      console.log(`[Tavern Helper] Notes loaded, length: ${notes.length}`);\n      if (debug && notes.length > 0) {\n        console.debug('First 100 chars:', notes.substring(0, 100) + '...');\n      }\n    } else {\n      console.error('[Tavern Helper] window.loadNotes not defined');\n    }\n\n    // Load OCC notes\n    if (typeof (window as any).loadOCCNotes === 'function') {\n      const occNotes = (window as any).loadOCCNotes();\n      const occTextarea = querySafe('#tavern-helper-occ');\n      occTextarea?.val(occNotes);\n      console.log(`[Tavern Helper] OCC notes loaded, length: ${occNotes.length}`);\n    }\n  } else {\n    // Save both textareas when hiding\n    if (typeof window.saveCurrentNotes === 'function') {\n      console.log('[Tavern Helper] Auto-saving before hiding');\n      window.saveCurrentNotes();\n    } else {\n      console.warn('[Tavern Helper] window.saveCurrentNotes not defined, skipping auto-save');\n    }\n\n    if (typeof (window as any).saveCurrentOCC === 'function') {\n      (window as any).saveCurrentOCC();\n    } else if (typeof (window as any).saveOCCNotes === 'function') {\n      const occContent = $('#tavern-helper-occ').val() as string;\n      (window as any).saveOCCNotes(occContent);\n    }\n  }\n\n  console.groupEnd();\n}\n\nexport function showSidebar(): void {\n  if (!sidebarVisible) {\n    toggleSidebar();\n  }\n}\n\nexport function hideSidebar(): void {\n  if (sidebarVisible) {\n    toggleSidebar();\n  }\n}\n\nexport function initializeSidebar(): void {\n  const debug = (window as any).sidebarDebug;\n\n  // Use different console methods for better visibility\n  console.groupCollapsed('[Tavern Helper] Initializing sidebar...');\n  console.info('Start time:', new Date().toISOString());\n  console.debug('Debug flag:', debug);\n\n  injectCSS();\n  console.log('[Tavern Helper] CSS injected');\n\n  injectHTML();\n  console.log('[Tavern Helper] HTML injected');\n\n  setupEventListeners();\n  console.log('[Tavern Helper] Event listeners set up');\n\n  // Expose functions globally for inline handlers\n  window.toggleSidebar = toggleSidebar;\n  window.hideSidebar = hideSidebar;\n  window.showSidebar = showSidebar;\n\n  // Expose debug functions regardless of debug flag (but only attach if not already present)\n  (window as any).testSidebarButton = testSidebarButton;\n  (window as any).enableSidebarDebug = enableSidebarDebug;\n  console.info('[Tavern Helper] Debug functions exposed', debug ? '(debug mode active)' : '(global)');\n\n  console.log('[Tavern Helper] Global functions exposed');\n  console.groupEnd();\n\n  // Visual debug indicator if debug mode is active\n  if (debug) {\n    addVisualDebugIndicator();\n  }\n}\n\n// Debug test function that can be called from browser console\nexport function testSidebarButton(): boolean {\n  console.group('[Tavern Helper] Debug Test: Autosave Functionality');\n  console.info('Testing autosave functionality at', new Date().toISOString());\n\n  console.log('Save button removed - testing autosave functionality instead');\n\n  // Test storage functions\n  const storageAvailable = typeof localStorage !== 'undefined';\n  console.log('localStorage available:', storageAvailable);\n\n  const saveFnAvailable = typeof window.saveCurrentNotes === 'function';\n  console.log('saveCurrentNotes function available:', saveFnAvailable);\n\n  const textareaExists = querySafe('#tavern-helper-notes') !== null;\n  console.log('Textarea exists:', textareaExists);\n\n  const result = storageAvailable && saveFnAvailable && textareaExists;\n  console.log('Overall test result:', result ? 'PASS' : 'FAIL');\n  console.groupEnd();\n\n  return result;\n}\n\n// Enable debug mode with optional verbosity\nexport function enableSidebarDebug(verbose = true): void {\n  (window as any).sidebarDebug = true;\n  console.warn('[Tavern Helper] Debug mode enabled', verbose ? '(verbose)' : '');\n  if (verbose) {\n    console.log('[Tavern Helper] Current environment:', {\n      sidebarVisible,\n      sidebarId: SIDEBAR_ID,\n      jQueryLoaded: typeof $ !== 'undefined',\n      textareaExists: $('#tavern-helper-notes').length > 0,\n      debugFlag: (window as any).sidebarDebug,\n    });\n  }\n}\n\n// Add a small visual indicator when debug is active\nfunction addVisualDebugIndicator(): void {\n  const indicator = $('<div>')\n    .css({\n      position: 'fixed',\n      bottom: '10px',\n      right: '10px',\n      width: '20px',\n      height: '20px',\n      borderRadius: '50%',\n      background: '#ff5555',\n      border: '2px solid #ffb86c',\n      zIndex: '1000000',\n      opacity: '0.7',\n      pointerEvents: 'none',\n    })\n    .attr('title', 'Sidebar Debug Mode Active')\n    .appendTo('body');\n\n  // Add pulsing animation\n  $('<style>')\n    .text(\n      `\n        @keyframes debugPulse {\n            0% { opacity: 0.3; transform: scale(1); }\n            50% { opacity: 0.9; transform: scale(1.1); }\n            100% { opacity: 0.3; transform: scale(1); }\n        }\n        #tavern-helper-debug-indicator {\n            animation: debugPulse 2s infinite;\n        }\n    `,\n    )\n    .appendTo('head');\n\n  indicator.attr('id', 'tavern-helper-debug-indicator');\n\n  console.debug('[Tavern Helper] Visual debug indicator added');\n}\n\nexport function cleanupSidebar(): void {\n  $(`#${SIDEBAR_ID}`).remove();\n  $(`style:contains(\".tavern-helper-overlay-sidebar\")`).remove();\n  deteleportStyle();\n\n  // Remove global functions (they are optional due to TypeScript strictness)\n  delete (window as any).toggleSidebar;\n  delete (window as any).hideSidebar;\n  delete (window as any).showSidebar;\n  delete (window as any).testSidebarButton;\n  delete (window as any).enableSidebarDebug;\n}\n","export async function loadReadme(url: string): Promise<boolean> {\n  const readme = await fetch(url);\n  if (!readme.ok) {\n    return false;\n  }\n  const readme_text = await readme.text();\n  replaceScriptInfo(readme_text);\n  return true;\n}\n\nexport function teleportStyle() {\n  if ($(`head > div[script_id=\"${getScriptId()}\"]`).length > 0) {\n    return;\n  }\n  const $div = $(`<div>`).attr('script_id', getScriptId()).append($(`head > style`, document).clone());\n  $('head').append($div);\n}\n\nexport function deteleportStyle() {\n  $(`head > div[script_id=\"${getScriptId()}\"]`).remove();\n}\n\nexport function createScriptIdDiv(): JQuery<HTMLDivElement> {\n  return $('<div>').attr('script_id', getScriptId()) as JQuery<HTMLDivElement>;\n}\n\nexport function destroyScriptIdDiv(): void {\n  $(`div[script_id=\"${getScriptId()}\"]`).remove();\n}\n\nexport function reloadOnChatChange(): EventOnReturn {\n  let chat_id = SillyTavern.getCurrentChatId();\n  return eventOn(tavern_events.CHAT_CHANGED, new_chat_id => {\n    if (chat_id !== new_chat_id) {\n      chat_id = new_chat_id;\n      window.location.reload();\n    }\n  });\n}\n","// Variables integration for overlay sidebar quick notes\nimport { loadNotes, loadOCCNotes, saveNotes, saveOCCNotes } from './notes-storage';\nimport { querySafe } from './utils';\n\ndeclare global {\n  interface Window {\n    tavern_helper?: {\n      registerVariable?(\n        name: string,\n        config: {\n          get: () => any;\n          set?: (value: any) => void;\n          description?: string;\n        },\n      ): void;\n    };\n  }\n}\n\n// Function to get current script ID (if running in script context)\ndeclare function getScriptId(): string;\n\n// Standard tavern variable functions\ndeclare function insertOrAssignVariables(\n  variables: Record<string, any>,\n  option: { type: 'chat' | 'global' | 'preset' | 'character' | 'message' | 'script' | 'extension' },\n): Record<string, any>;\n\ndeclare function getVariables(option: {\n  type: 'chat' | 'global' | 'preset' | 'character' | 'message' | 'script' | 'extension';\n}): Record<string, any>;\n\nconst VARIABLE_NAME = 'overlaySidebar_quickNotes';\nconst VARIABLE_DESCRIPTION = 'Quick notes from the overlay sidebar';\nconst VARIABLE_NAME_OCC = 'overlaySidebar_OCC';\nconst VARIABLE_DESCRIPTION_OCC = 'Out-of-character notes from the overlay sidebar';\n\n/**\n * Update the tavern variable system with the current notes content\n * This ensures {{getvar::overlaySidebar_quickNotes}} macro works\n */\nfunction updateTavernVariable(content: string): void {\n  try {\n    // Update script variable (since script variables are accessible via macros)\n    if (typeof insertOrAssignVariables === 'function') {\n      insertOrAssignVariables({ [VARIABLE_NAME]: content }, { type: 'script' });\n      // Also update chat variable for broader accessibility\n      insertOrAssignVariables({ [VARIABLE_NAME]: content }, { type: 'chat' });\n      console.log(`[Tavern Helper] Updated tavern variable ${VARIABLE_NAME} with ${content.length} chars`);\n    } else {\n      // Fallback to localStorage\n      fallbackVariableSync(content);\n    }\n  } catch (error) {\n    console.error('[Tavern Helper] Failed to update tavern variable:', error);\n    // Fallback to localStorage\n    fallbackVariableSync(content);\n  }\n}\n\nfunction updateOCCVariable(content: string): void {\n  try {\n    if (typeof insertOrAssignVariables === 'function') {\n      insertOrAssignVariables({ [VARIABLE_NAME_OCC]: content }, { type: 'script' });\n      insertOrAssignVariables({ [VARIABLE_NAME_OCC]: content }, { type: 'chat' });\n      console.log(`[Tavern Helper] Updated tavern variable ${VARIABLE_NAME_OCC} with ${content.length} chars`);\n    } else {\n      fallbackOCCVariableSync(content);\n    }\n  } catch (error) {\n    console.error('[Tavern Helper] Failed to update OCC tavern variable:', error);\n    fallbackOCCVariableSync(content);\n  }\n}\n\n/**\n * Retrieve current notes content from tavern variable system\n * This serves as a fallback for get()\n */\nfunction retrieveFromTavernVariable(): string {\n  try {\n    // Try script variable first if function exists\n    if (typeof getVariables === 'function') {\n      const scriptVars = getVariables({ type: 'script' });\n      if (scriptVars && typeof scriptVars[VARIABLE_NAME] === 'string') {\n        return scriptVars[VARIABLE_NAME];\n      }\n      // Try chat variable\n      const chatVars = getVariables({ type: 'chat' });\n      if (chatVars && typeof chatVars[VARIABLE_NAME] === 'string') {\n        return chatVars[VARIABLE_NAME];\n      }\n    } else {\n      // Fallback to localStorage\n      return getNotesFromFallback();\n    }\n  } catch (error) {\n    // Silently fail, fall back to localStorage\n  }\n  return '';\n}\n\nfunction retrieveOCCFromTavernVariable(): string {\n  try {\n    if (typeof getVariables === 'function') {\n      const scriptVars = getVariables({ type: 'script' });\n      if (scriptVars && typeof scriptVars[VARIABLE_NAME_OCC] === 'string') {\n        return scriptVars[VARIABLE_NAME_OCC];\n      }\n      const chatVars = getVariables({ type: 'chat' });\n      if (chatVars && typeof chatVars[VARIABLE_NAME_OCC] === 'string') {\n        return chatVars[VARIABLE_NAME_OCC];\n      }\n    } else {\n      return getOCCNotesFromFallback();\n    }\n  } catch (error) {\n    // Silently fail\n  }\n  return '';\n}\n\nexport function registerQuickNotesVariable(): void {\n  // First, ensure the variable is present in the tavern variable system\n  const currentNotes = loadNotes();\n  updateTavernVariable(currentNotes);\n\n  // Also register with custom tavern_helper API if available (for UI integration)\n  if (window.tavern_helper?.registerVariable) {\n    try {\n      window.tavern_helper.registerVariable(VARIABLE_NAME, {\n        get: () => {\n          // First try localStorage, then fallback to tavern variable\n          const notes = loadNotes();\n          if (notes) return notes;\n          return retrieveFromTavernVariable();\n        },\n        set: value => {\n          if (typeof value === 'string') {\n            saveNotes(value);\n            updateTavernVariable(value);\n            // Update UI if sidebar is visible using safe selector\n            const textarea = querySafe('#tavern-helper-notes');\n            if (textarea) {\n              textarea.val(value);\n            }\n          }\n        },\n        description: VARIABLE_DESCRIPTION,\n      });\n      console.log(`[Tavern Helper] Registered custom tavern variable: ${VARIABLE_NAME}`);\n    } catch (error) {\n      console.error('[Tavern Helper] Failed to register custom variable:', error);\n    }\n  }\n\n  console.log(`[Tavern Helper] Tavern variable ${VARIABLE_NAME} is now available for macros`);\n}\n\nexport function registerOCCVariable(): void {\n  // Ensure the OCC variable is present in tavern variable system\n  const currentOCC = loadOCCNotes();\n  updateOCCVariable(currentOCC);\n\n  if (window.tavern_helper?.registerVariable) {\n    try {\n      window.tavern_helper.registerVariable(VARIABLE_NAME_OCC, {\n        get: () => {\n          const occ = loadOCCNotes();\n          if (occ) return occ;\n          return retrieveOCCFromTavernVariable();\n        },\n        set: value => {\n          if (typeof value === 'string') {\n            saveOCCNotes(value);\n            updateOCCVariable(value);\n            const textarea = querySafe('#tavern-helper-occ');\n            if (textarea) {\n              textarea.val(value);\n            }\n          }\n        },\n        description: VARIABLE_DESCRIPTION_OCC,\n      });\n      console.log(`[Tavern Helper] Registered custom tavern variable: ${VARIABLE_NAME_OCC}`);\n    } catch (error) {\n      console.error('[Tavern Helper] Failed to register OCC custom variable:', error);\n    }\n  }\n\n  console.log(`[Tavern Helper] Tavern variable ${VARIABLE_NAME_OCC} is now available for macros`);\n}\n\n/**\n * Function to sync notes to tavern variable system (call when notes change)\n * This is called immediately on input to ensure macros are updated in real-time\n */\nexport function syncNotesToVariable(content: string): void {\n  updateTavernVariable(content);\n}\n\n/**\n * Function to sync OCC notes to tavern variable system\n */\nexport function syncOCCToVariable(content: string): void {\n  updateOCCVariable(content);\n}\n\n/**\n * Fallback implementation using localStorage when tavern variable functions are not available\n */\nexport function fallbackVariableSync(content: string): void {\n  try {\n    localStorage.setItem('overlaySidebar_quickNotes_fallback', content);\n    console.debug('[Tavern Helper] Fallback variable sync:', content.length, 'chars');\n  } catch (error) {\n    console.warn('[Tavern Helper] Fallback sync failed:', error);\n  }\n}\n\n/**\n * Fallback implementation for OCC variable\n */\nexport function fallbackOCCVariableSync(content: string): void {\n  try {\n    localStorage.setItem('overlaySidebar_OCC_fallback', content);\n    console.debug('[Tavern Helper] Fallback OCC variable sync:', content.length, 'chars');\n  } catch (error) {\n    console.warn('[Tavern Helper] Fallback OCC sync failed:', error);\n  }\n}\n\n/**\n * Retrieve notes from fallback storage\n */\nexport function getNotesFromFallback(): string {\n  try {\n    return localStorage.getItem('overlaySidebar_quickNotes_fallback') || '';\n  } catch {\n    return '';\n  }\n}\n\n/**\n * Retrieve OCC notes from fallback storage\n */\nexport function getOCCNotesFromFallback(): string {\n  try {\n    return localStorage.getItem('overlaySidebar_OCC_fallback') || '';\n  } catch {\n    return '';\n  }\n}\n\n// Export additional helper functions for external use\nexport {\n  retrieveFromTavernVariable,\n  updateTavernVariable,\n  VARIABLE_DESCRIPTION,\n  VARIABLE_DESCRIPTION_OCC,\n  VARIABLE_NAME,\n  VARIABLE_NAME_OCC,\n};\n\nexport function unregisterQuickNotesVariable(): void {\n  // Currently there's no unregister API, but we could implement tracking if needed\n  console.log(`[Tavern Helper] Variable ${VARIABLE_NAME} would be unregistered if API existed`);\n}\n","// Load and unload handlers for overlay sidebar script\nimport { cleanupAutoSave, setupAutoSave, triggerAutoSave } from './notes-storage';\nimport { cleanupSidebar, initializeSidebar } from './sidebar-logic';\nimport { checkDependencies, safeEventOn, safeGetButtonEvent, safeReplaceScriptButtons } from './utils';\nimport { registerQuickNotesVariable, syncNotesToVariable } from './variables-integration';\n\n// On script load\n$(() => {\n  console.log('[Tavern Helper] Overlay Sidebar script loading...');\n\n  // Check dependencies for debugging (result unused intentionally for logging only)\n  checkDependencies(['jQuery', 'localStorage', 'replaceScriptButtons', 'eventOn', 'getButtonEvent']);\n\n  // Initialize the sidebar UI\n  initializeSidebar();\n\n  // Setup auto-save for notes\n  setupAutoSave();\n\n  // Setup safety auto-save on unload\n  $(window).on('beforeunload', () => {\n    triggerAutoSave();\n  });\n\n  // Also save when sidebar hides\n  $(document).on('sidebar:hidden', () => {\n    triggerAutoSave();\n  });\n\n  // Register tavern variable for quick notes\n  registerQuickNotesVariable();\n\n  // Add toggle button to SillyTavern script panel with safety check\n  safeReplaceScriptButtons([{ name: '📝 Quick Notes', visible: true }], () => {\n    // Fallback: try to add button manually if replaceScriptButtons fails\n    console.warn('[Tavern Helper] Using fallback button placement');\n    const button = $('<button>').text('📝 Quick Notes').addClass('script-button');\n    button.on('click', () => {\n      window.toggleSidebar?.();\n    });\n    $('#scriptButtons').append(button);\n  });\n\n  // Register button event with safety\n  const buttonEvent = safeGetButtonEvent('📝 Quick Notes', 'scriptButton:click:quick_notes');\n  if (buttonEvent) {\n    safeEventOn(\n      buttonEvent,\n      () => {\n        if (typeof window.toggleSidebar === 'function') {\n          window.toggleSidebar();\n        } else {\n          console.warn('[Tavern Helper] toggleSidebar not available');\n        }\n      },\n      () => {\n        // Fallback: direct click handler\n        console.warn('[Tavern Helper] Using fallback button click handler');\n        $('button:contains(\"📝 Quick Notes\")').on('click', () => {\n          window.toggleSidebar?.();\n        });\n      },\n    );\n  } else {\n    console.warn('[Tavern Helper] Could not get button event name');\n  }\n\n  // Expose syncNotesToVariable globally for notes-storage to call\n  (window as any).syncNotesToVariable = syncNotesToVariable;\n\n  console.log('[Tavern Helper] Overlay Sidebar script loaded successfully');\n});\n\n// On script unload (when user disables script or changes chat)\n$(window).on('pagehide', () => {\n  console.log('[Tavern Helper] Overlay Sidebar script unloading...');\n\n  // Trigger final auto-save before unloading\n  triggerAutoSave();\n\n  // Cleanup sidebar UI\n  cleanupSidebar();\n\n  // Cleanup auto-save timers\n  cleanupAutoSave();\n\n  // Remove button from script panel\n  // Note: replaceScriptButtons with empty array will remove our button\n  // but may affect other scripts, so we rely on automatic cleanup\n\n  console.log('[Tavern Helper] Overlay Sidebar script unloaded');\n});\n\n// Cleanup on chat change\nif (typeof (window as any).tavern_events !== 'undefined') {\n  const tavernEvents = (window as any).tavern_events;\n  if (typeof (window as any).eventOn === 'function' && tavernEvents.CHAT_CHANGED) {\n    (window as any).eventOn(tavernEvents.CHAT_CHANGED, () => {\n      console.log('[Tavern Helper] Chat changed, sidebar cleanup');\n      // Reload notes will happen when sidebar is next opened\n    });\n  }\n}\n","import { setupAutoSave } from './notes-storage';\nimport { initializeSidebar } from './sidebar-logic';\nimport { registerOCCVariable, registerQuickNotesVariable } from './variables-integration';\nimport './加载和卸载时执行函数';\n\n// Debug logging initiation with comprehensive environment detection\nconsole.info('[Tavern Helper] Sidebar script loading at', new Date().toISOString());\nconsole.debug('[Tavern Helper] Environment info:', {\n  userAgent: navigator.userAgent,\n  location: window.location.href,\n  jQuery: typeof $ !== 'undefined' ? $.fn?.jquery || 'unknown' : 'not loaded',\n  jQueryVersion: typeof jQuery !== 'undefined' ? jQuery.fn?.jquery || 'unknown' : 'not loaded',\n  consoleAvailable: typeof console !== 'undefined',\n  localStorageAvailable: typeof localStorage !== 'undefined',\n  sidebarDebug: (window as any).sidebarDebug || 'not set',\n  scriptVersion: '2.0-revised',\n});\n\n// Global debug flag that can be toggled via browser console\n(window as any).sidebarDebug = (window as any).sidebarDebug || false;\n\n// Environment safety checks\nif (typeof $ === 'undefined') {\n  console.warn('[Tavern Helper] jQuery ($) not found - sidebar may not work correctly');\n}\nif (typeof localStorage === 'undefined') {\n  console.error('[Tavern Helper] localStorage unavailable - notes cannot be saved');\n}\n\n// Signal that script loaded\nconsole.log('[Tavern Helper] Sidebar module loaded successfully');\n\n// Wait for DOM ready before initialization\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', () => {\n    console.log('[Tavern Helper] DOM ready, initializing sidebar');\n    initializeSidebar();\n    registerQuickNotesVariable();\n    registerOCCVariable();\n    setupAutoSave();\n    console.log('[Tavern Helper] Full initialization completed');\n  });\n} else {\n  // DOM already loaded\n  console.log('[Tavern Helper] DOM already ready, initializing immediately');\n  initializeSidebar();\n  registerQuickNotesVariable();\n  registerOCCVariable();\n  setupAutoSave();\n  console.log('[Tavern Helper] Full initialization completed');\n}\n\n// Global availability test function\n(window as any).testSidebarAvailability = function () {\n  console.group('[Tavern Helper] Global Function Availability Test');\n\n  const functions = [\n    'toggleSidebar',\n    'hideSidebar',\n    'showSidebar',\n    'testSidebarButton',\n    'enableSidebarDebug',\n    'saveCurrentNotes',\n    'loadNotes',\n  ];\n\n  const results: Record<string, string> = {};\n  let allAvailable = true;\n\n  functions.forEach(fnName => {\n    const exists = typeof (window as any)[fnName] === 'function';\n    results[fnName] = exists ? '✅ Available' : '❌ Missing';\n    if (!exists) allAvailable = false;\n    console.log(`${fnName}: ${results[fnName]}`);\n  });\n\n  console.log(`Overall: ${allAvailable ? '✅ All functions available' : '❌ Some functions missing'}`);\n  console.log('Window object check:', Object.keys(results));\n  console.groupEnd();\n  return allAvailable;\n};\n\n// Auto-run test if debug mode is enabled\nif ((window as any).sidebarDebug) {\n  setTimeout(() => {\n    console.log('[Tavern Helper] Auto-running availability test...');\n    (window as any).testSidebarAvailability();\n  }, 1000);\n}\n"],"names":["querySafe","selector","context","$","console","warn","result","length","window","sidebarDebug","debug","error","eventUtils","on","element","eventType","handler","$element","off","once","one","checkDependencies","dependencies","results","missing","dep","available","localStorage","replaceScriptButtons","eventOn","getButtonEvent","push","join","groupCollapsed","table","groupEnd","safeReplaceScriptButtons","buttons","fallbackAction","log","map","b","name","safeEventOn","eventName","safeGetButtonEvent","buttonName","fallbackEventName","generateStorageKey","prefix","chatId","SillyTavern","getCurrentChatId","id","sessionStorage","getItem","getStorageKey","getOCCStorageKey","saveNotes","content","storageKey","setItem","syncNotesToVariable","e","saveOCCNotes","syncOCCToVariable","loadNotes","loadOCCNotes","DEFAULT_AUTO_SAVE_CONFIG","enabled","delay","autoSaveTimeout","occAutoSaveTimeout","currentConfig","setupAutoSave","document","this","val","clearTimeout","setTimeout","triggerAutoSave","notesElement","saveCurrentNotes","saveCurrentOCC","SIDEBAR_ID","sidebarVisible","injectCSS","text","appendTo","getScriptId","$div","attr","append","clone","teleportStyle","toggleSidebar","info","sidebar","toggleClass","textarea","trigger","notes","substring","occNotes","occTextarea","occContent","showSidebar","hideSidebar","initializeSidebar","Date","toISOString","injectHTML","key","testSidebarButton","enableSidebarDebug","indicator","css","position","bottom","right","width","height","borderRadius","background","border","zIndex","opacity","pointerEvents","addVisualDebugIndicator","group","storageAvailable","saveFnAvailable","textareaExists","verbose","sidebarId","jQueryLoaded","debugFlag","cleanupSidebar","remove","VARIABLE_NAME","VARIABLE_NAME_OCC","updateTavernVariable","insertOrAssignVariables","type","fallbackVariableSync","updateOCCVariable","fallbackOCCVariableSync","retrieveFromTavernVariable","getVariables","getNotesFromFallback","scriptVars","chatVars","retrieveOCCFromTavernVariable","getOCCNotesFromFallback","registerQuickNotesVariable","tavern_helper","registerVariable","get","set","value","description","registerOCCVariable","occ","visible","button","addClass","buttonEvent","tavern_events","tavernEvents","CHAT_CHANGED","userAgent","navigator","location","href","jQuery","fn","jquery","jQueryVersion","consoleAvailable","localStorageAvailable","scriptVersion","readyState","addEventListener","testSidebarAvailability","allAvailable","forEach","fnName","exists","Object","keys"],"ignoreList":[],"sourceRoot":""}