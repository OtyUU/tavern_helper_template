{"version":3,"file":"index.js","mappings":"AAAA,MAAM,EAA+BA,ECC/BC,EAAa,sCAGbC,EAAiB,EAAAF,EAAEG,OAAO,CAC5BC,KAAM,EAAAJ,EAAEK,KAAK,CAAC,MAAO,UAAUC,QAAQ,OACvCC,IAAK,EAAAP,EAAEQ,SAASC,IAAI,GAAGH,QAAQ,eAC/BI,aAAc,EAAAV,EAAEQ,SAASF,QAAQ,MAErC,IAAIK,GAAiB,EACrB,SAASC,IACL,IACI,MAAMC,EAAOC,aAAa,CAAEC,KAAM,WAClC,OAAOb,EAAec,MAAMH,EAChC,CACA,MAAOI,GACH,OAAOf,EAAec,MAAM,CAAC,EACjC,CACJ,CACA,SAASE,EAAaC,GAClBC,iBAAiBD,EAAU,CAAEJ,KAAM,UACvC,CACA,SAASM,IACL,MAAMC,EAAM,UACTrB,2qBAqBAA,+DAIAA,iUAYAA,oGAMAA,gUAYAA,qGAKAA,mGAMAA,2HAOAA,qNASAA,oQAWAA,8OAWAA,kEAIAA,2KAQAA,8PAYAA,0FAKAA,0HAOAA,6GAMAA,oEAIAA,4EAKAA,kEAIAA,oWAcAA,0EAIAA,gPAWAA,+DAIHsB,EAAE,WAAWC,KAAKF,GAAKG,SAAS,QC9M7B,WACL,GAAIF,EAAE,yBAAyBG,mBAAmBC,OAAS,EACzD,OAEF,MAAMC,EAAOL,EAAE,SAASM,KAAK,YAAaH,eAAeI,OAAOP,EAAE,eAAgBQ,UAAUC,SAC5FT,EAAE,QAAQO,OAAOF,EACnB,CDyMIK,EACJ,CACA,SAASC,IACL,GAAIX,EAAE,IAAItB,KAAc0B,OAAS,EAC7B,OACJ,MAAMR,EAAWP,IACXR,EAAOe,EAASf,MAAQ,MACxB+B,EAAO,kBACFlC,0PAMyBA,qGAGlBA,kBAA2BkB,EAASZ,qIAIV,QAATH,EAAiB,SAAW,0EACnB,UAATA,EAAmB,SAAW,sIAGtB,QAATA,EAAiB,SAAW,8DACXH,uBAAiD,gBAAjBkB,EAASZ,IAAwB,GAAKY,EAASZ,6GAC3FN,sFAEM,UAATG,EAAmB,SAAW,0DACnBH,uEAAgFkB,EAAST,uEAC/FT,gGAMzCsB,EAAE,QAAQO,OAAOK,GACjBZ,EAAE,IAAItB,WAAoBmC,GAAG,QAAS,IAAMC,GAAc,IAE1Dd,EAAE,gBAAgBa,GAAG,QAAS,YAuDlC,SAAoBE,GAChB,MAAMnB,EAAWP,IACjBM,EAAa,IAAKC,EAAUf,KAAMkC,IAElCf,EAAE,gBAAgBgB,YAAY,UAC9BhB,EAAE,2BAA2Be,OAAaE,SAAS,UACnDjB,EAAE,kBAAkBkB,YAAY,SAAsB,QAAZH,GAC1Cf,EAAE,oBAAoBkB,YAAY,SAAsB,UAAZH,GAC5CI,OAAOC,KAAK,eAAeL,SAC/B,CA9DQM,CADqBrB,EAAEsB,MAAMC,KAAK,QAEtC,GAEAvB,EAAE,IAAItB,cAAuBmC,GAAG,QAAS,KACrC,MAAM7B,EAAMgB,EAAE,IAAItB,eAAwB8C,MAAMC,OAC5CzC,GACA0C,EAAU1C,KAGlBgB,EAAE,IAAItB,eAAwBmC,GAAG,WAAYnB,IACzC,GAAgB,KAAZA,EAAEiC,MAAc,CAChB,MAAM3C,EAAMgB,EAAE,IAAItB,eAAwB8C,MAAMC,OAC5CzC,GACA0C,EAAU1C,EAClB,IAGJgB,EAAE,IAAItB,gBAAyBmC,GAAG,QAAS,KACvC,MAAMe,EAAO5B,EAAE,IAAItB,oBAA6B8C,MAC5CI,EAAKH,QACLI,EAAiBD,KAGzB5B,EAAE,IAAItB,oBAA6BmC,GAAG,QAAS,KAC3C,MAAMe,EAAO5B,EAAE,IAAItB,oBAA6B8C,MAChD7B,EAAa,IAAKN,IAAeF,aAAcyC,MAGtC,UAAT/C,GAAoBe,EAAST,cAC7B0C,EAAiBjC,EAAST,aAElC,CACA,SAASuC,EAAU1C,GACf,IAESA,EAAI8C,WAAW,YACf9C,EAAI8C,WAAW,aACf9C,EAAI8C,WAAW,OACf9C,EAAI8C,WAAW,MACR,gBAAR9C,GACIA,EAAI+C,SAAS,OAAS/C,EAAI+C,SAAS,OACnC/C,EAAM,WAAaA,GAG3BL,EAAec,MAAM,CAAET,QACvBgB,EAAE,IAAItB,YAAqB4B,KAAK,MAAOtB,GACvCW,EAAa,CAAEX,QACfmC,OAAOa,QAAQ,yBACnB,CACA,MAAOtC,GACHyB,OAAOc,MAAM,qBACjB,CACJ,CAWA,SAASJ,EAAiBD,GACtB,IAEI,MACMM,GADS,IAAIC,WACAC,gBAAgBR,EAAM,aAEzC,IAAIS,EAAcH,EAAII,KAAKC,UACtBF,EAAYZ,SAEbY,EAAcH,EAAIM,gBAAgBC,WAGtC,MAAMC,EAASC,MAAMC,KAAKV,EAAIW,iBAAiB,UAC1CC,IAAIC,GAASA,EAAMC,aACnBC,KAAK,MAMJC,EAAW,uEAIdR,iCAGPL,gBAXoBM,MAAMC,KAAKV,EAAIW,iBAAiB,WAC3CC,IAAIK,GAAUA,EAAOH,aACrBC,KAAK,oCAcJG,EAAO,IAAIC,KAAK,CAACH,GAAW,CAAE1D,KAAM,cACpC8D,EAAUC,IAAIC,gBAAgBJ,GAEpCpD,EAAE,IAAItB,YAAqB4B,KAAK,MAAOgD,GAGvC3D,EAAa,IADIN,IACWF,aAAcyC,IAC1CT,OAAOa,QAAQ,6BACnB,CACA,MAAOC,GACHwB,QAAQxB,MAAM,gCAAiCA,GAC/Cd,OAAOc,MAAM,2BAA6BA,aAAiByB,MAAQzB,EAAM0B,QAAUC,OAAO3B,IAC9F,CACJ,CACA,SAASnB,EAAc+C,GACnBzE,EAAiC,kBAATyE,EAAqBA,GAAQzE,EACrDY,EAAE,IAAItB,KAAcwC,YAAY,UAAW9B,EAC/C,CAEAY,EAAE,KACEF,IACAa,IACA,MAAMmD,EAAa,wBAMnB,GAJoC,mBAAzBC,sBACPA,qBAAqB,CAAC,CAAEC,KAAMF,EAAYG,SAAS,KAGzB,mBAAnBC,eAA+B,CACtC,MAAMC,EAAYD,eAAeJ,GACjCM,QAAQD,EAAW,IAAMrD,IAC7B,CAEAd,EAAEQ,UAAUK,GAAG,UAAWnB,IACR,WAAVA,EAAE2E,KAAoBjF,GACtB0B,GAAc,OAK1Bd,EAAEsE,QAAQzD,GAAG,WAAY,KACrBb,EAAE,IAAItB,KAAc6F,SCxXtBvE,EAAE,yBAAyBG,mBAAmBoE","sources":["src://tavern_helper_template/external var \"z\"","src://tavern_helper_template/src/external-html-sidebar/index.ts","src://tavern_helper_template/src/util/script.ts"],"sourcesContent":["const __WEBPACK_NAMESPACE_OBJECT__ = z;","import { deteleportStyle, teleportStyle } from '../util/script';\nconst SIDEBAR_ID = 'tavern-helper-external-html-sidebar';\nconst SIDEBAR_WIDTH = '500px';\n// Zod schema for settings\nconst SettingsSchema = z.object({\n    mode: z.enum(['url', 'paste']).default('url'),\n    url: z.string().min(1).default('about:blank'),\n    pasteContent: z.string().default(''),\n});\nlet sidebarVisible = false;\nfunction getSettings() {\n    try {\n        const vars = getVariables({ type: 'script' });\n        return SettingsSchema.parse(vars);\n    }\n    catch (e) {\n        return SettingsSchema.parse({});\n    }\n}\nfunction saveSettings(settings) {\n    replaceVariables(settings, { type: 'script' });\n}\nfunction injectCSS() {\n    const css = `\n    #${SIDEBAR_ID} {\n      position: fixed;\n      top: 0;\n      right: 0;\n      width: ${SIDEBAR_WIDTH};\n      height: 100vh;\n      background: rgba(29, 33, 40, 0.95);\n      backdrop-filter: blur(5px);\n      border-left: 0.5px solid rgba(0, 0, 0, 0.5);\n      border-top-left-radius: 12px;\n      border-bottom-left-radius: 12px;\n      z-index: 999999;\n      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n      transform: translateX(100%);\n      display: flex;\n      flex-direction: column;\n      color: rgba(207, 207, 197, 1);\n      box-shadow: -2px 0 10px rgba(0, 0, 0, 0.5);\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;\n    }\n\n    #${SIDEBAR_ID}.visible {\n      transform: translateX(0);\n    }\n\n    #${SIDEBAR_ID} .header {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      padding: 0 20px;\n      height: 50px;\n      background: rgba(29, 33, 40, 0.98);\n      border-bottom: 0.5px solid rgba(0, 0, 0, 0.8);\n      border-top-left-radius: 12px;\n      flex-shrink: 0;\n    }\n\n    #${SIDEBAR_ID} .header h3 {\n      margin: 0;\n      font-size: 16px;\n      font-weight: 500;\n    }\n\n    #${SIDEBAR_ID} .close-btn {\n      background: rgba(29, 33, 40, 0.6);\n      border: 0.5px solid rgba(0, 0, 0, 0.8);\n      color: rgba(207, 207, 197, 0.9);\n      cursor: pointer;\n      padding: 5px 12px;\n      border-radius: 8px;\n      font-size: 20px;\n      transition: all 0.2s ease;\n      line-height: 1;\n    }\n\n    #${SIDEBAR_ID} .close-btn:hover {\n      background: rgba(40, 45, 52, 0.8);\n      color: #fff;\n    }\n\n    #${SIDEBAR_ID} .content {\n      flex: 1;\n      overflow: hidden;\n      position: relative;\n    }\n\n    #${SIDEBAR_ID} iframe {\n      width: 100%;\n      height: 100%;\n      border: none;\n      background: transparent;\n    }\n\n    #${SIDEBAR_ID} .footer {\n      padding: 10px 15px;\n      background: rgba(29, 33, 40, 0.98);\n      border-top: 0.5px solid rgba(0, 0, 0, 0.8);\n      display: flex;\n      gap: 8px;\n      flex-shrink: 0;\n    }\n\n    #${SIDEBAR_ID} .url-input {\n      flex: 1;\n      background: rgba(0, 0, 0, 0.3);\n      border: 0.5px solid rgba(255, 255, 255, 0.1);\n      border-radius: 6px;\n      color: #fff;\n      padding: 6px 10px;\n      font-size: 12px;\n      outline: none;\n    }\n\n    #${SIDEBAR_ID} .load-btn {\n      background: #4a5568;\n      border: none;\n      border-radius: 6px;\n      color: #fff;\n      padding: 6px 12px;\n      font-size: 12px;\n      cursor: pointer;\n      transition: background 0.2s;\n    }\n\n    #${SIDEBAR_ID} .load-btn:hover {\n      background: #2d3748;\n    }\n\n    #${SIDEBAR_ID} .mode-toggle {\n      display: flex;\n      background: rgba(0, 0, 0, 0.3);\n      border-radius: 6px;\n      padding: 2px;\n      margin-bottom: 8px;\n    }\n\n    #${SIDEBAR_ID} .mode-option {\n      flex: 1;\n      background: transparent;\n      border: none;\n      color: #aaa;\n      padding: 6px 12px;\n      border-radius: 4px;\n      font-size: 12px;\n      cursor: pointer;\n      transition: all 0.2s;\n    }\n\n    #${SIDEBAR_ID} .mode-option.active {\n      background: #4a5568;\n      color: #fff;\n    }\n\n    #${SIDEBAR_ID} .mode-content {\n      display: flex;\n      flex-direction: column;\n      gap: 8px;\n      flex: 1;\n    }\n\n    #${SIDEBAR_ID} .paste-container {\n      display: none;\n      flex-direction: column;\n      gap: 8px;\n    }\n\n    #${SIDEBAR_ID} .paste-container.active {\n      display: flex;\n    }\n\n    #${SIDEBAR_ID} .url-container {\n      display: none;\n      gap: 8px;\n    }\n\n    #${SIDEBAR_ID} .url-container.active {\n      display: flex;\n    }\n\n    #${SIDEBAR_ID} .paste-textarea {\n      flex: 1;\n      background: rgba(0, 0, 0, 0.3);\n      border: 0.5px solid rgba(255, 255, 255, 0.1);\n      border-radius: 6px;\n      color: #fff;\n      padding: 8px;\n      font-size: 12px;\n      font-family: 'Courier New', monospace;\n      resize: vertical;\n      min-height: 60px;\n      outline: none;\n    }\n\n    #${SIDEBAR_ID} .paste-textarea:focus {\n      border-color: #4a5568;\n    }\n\n    #${SIDEBAR_ID} .render-btn {\n      background: #4a5568;\n      border: none;\n      border-radius: 6px;\n      color: #fff;\n      padding: 6px 12px;\n      font-size: 12px;\n      cursor: pointer;\n      transition: background 0.2s;\n    }\n\n    #${SIDEBAR_ID} .render-btn:hover {\n      background: #2d3748;\n    }\n  `;\n    $('<style>').text(css).appendTo('head');\n    teleportStyle();\n}\nfunction injectHTML() {\n    if ($(`#${SIDEBAR_ID}`).length > 0)\n        return;\n    const settings = getSettings();\n    const mode = settings.mode || 'url';\n    const html = `\n    <div id=\"${SIDEBAR_ID}\">\n      <div class=\"header\">\n        <div style=\"display: flex; align-items: center; gap: 8px;\">\n          <span style=\"font-size: 18px;\">üåê</span>\n          <h3>External Interface</h3>\n        </div>\n        <button class=\"close-btn\" id=\"${SIDEBAR_ID}-close\" title=\"Close\">√ó</button>\n      </div>\n      <div class=\"content\">\n        <iframe id=\"${SIDEBAR_ID}-iframe\" src=\"${settings.url}\"></iframe>\n      </div>\n      <div class=\"footer\">\n        <div class=\"mode-toggle\">\n          <button class=\"mode-option ${mode === 'url' ? 'active' : ''}\" data-mode=\"url\">URL</button>\n          <button class=\"mode-option ${mode === 'paste' ? 'active' : ''}\" data-mode=\"paste\">Paste Code</button>\n        </div>\n        <div class=\"mode-content\">\n          <div class=\"url-container ${mode === 'url' ? 'active' : ''}\">\n            <input type=\"text\" class=\"url-input\" id=\"${SIDEBAR_ID}-url-input\" value=\"${settings.url === 'about:blank' ? '' : settings.url}\" placeholder=\"Enter HTML URL (e.g. ./panel/index.html)...\">\n            <button class=\"load-btn\" id=\"${SIDEBAR_ID}-load-btn\">Load</button>\n          </div>\n          <div class=\"paste-container ${mode === 'paste' ? 'active' : ''}\">\n            <textarea class=\"paste-textarea\" id=\"${SIDEBAR_ID}-paste-textarea\" placeholder=\"Paste your HTML/CSS/JS code here...\">${settings.pasteContent}</textarea>\n            <button class=\"render-btn\" id=\"${SIDEBAR_ID}-render-btn\">Render</button>\n          </div>\n        </div>\n      </div>\n    </div>\n  `;\n    $('body').append(html);\n    $(`#${SIDEBAR_ID}-close`).on('click', () => toggleSidebar(false));\n    // Mode toggle functionality\n    $(`.mode-option`).on('click', function () {\n        const selectedMode = $(this).data('mode');\n        switchMode(selectedMode);\n    });\n    // URL mode functionality\n    $(`#${SIDEBAR_ID}-load-btn`).on('click', () => {\n        const url = $(`#${SIDEBAR_ID}-url-input`).val().trim();\n        if (url) {\n            updateUrl(url);\n        }\n    });\n    $(`#${SIDEBAR_ID}-url-input`).on('keypress', e => {\n        if (e.which === 13) {\n            const url = $(`#${SIDEBAR_ID}-url-input`).val().trim();\n            if (url)\n                updateUrl(url);\n        }\n    });\n    // Paste mode functionality\n    $(`#${SIDEBAR_ID}-render-btn`).on('click', () => {\n        const code = $(`#${SIDEBAR_ID}-paste-textarea`).val();\n        if (code.trim()) {\n            renderPastedCode(code);\n        }\n    });\n    $(`#${SIDEBAR_ID}-paste-textarea`).on('input', () => {\n        const code = $(`#${SIDEBAR_ID}-paste-textarea`).val();\n        saveSettings({ ...getSettings(), pasteContent: code });\n    });\n    // Initialize based on current mode\n    if (mode === 'paste' && settings.pasteContent) {\n        renderPastedCode(settings.pasteContent);\n    }\n}\nfunction updateUrl(url) {\n    try {\n        // Add protocol if missing and it looks like a domain\n        if (!url.startsWith('http://') &&\n            !url.startsWith('https://') &&\n            !url.startsWith('./') &&\n            !url.startsWith('/') &&\n            url !== 'about:blank') {\n            if (url.includes('.') && !url.includes(' ')) {\n                url = 'https://' + url;\n            }\n        }\n        SettingsSchema.parse({ url });\n        $(`#${SIDEBAR_ID}-iframe`).attr('src', url);\n        saveSettings({ url });\n        toastr.success('URL updated and loaded');\n    }\n    catch (e) {\n        toastr.error('Invalid URL format');\n    }\n}\nfunction switchMode(newMode) {\n    const settings = getSettings();\n    saveSettings({ ...settings, mode: newMode });\n    // Update UI\n    $('.mode-option').removeClass('active');\n    $(`.mode-option[data-mode=\"${newMode}\"]`).addClass('active');\n    $('.url-container').toggleClass('active', newMode === 'url');\n    $('.paste-container').toggleClass('active', newMode === 'paste');\n    toastr.info(`Switched to ${newMode} mode`);\n}\nfunction renderPastedCode(code) {\n    try {\n        // Extract HTML, CSS, and JS from the pasted code\n        const parser = new DOMParser();\n        const doc = parser.parseFromString(code, 'text/html');\n        // Get the body content (remove outer body tags if present)\n        let htmlContent = doc.body.innerHTML;\n        if (!htmlContent.trim()) {\n            // If no body content, use the whole document\n            htmlContent = doc.documentElement.outerHTML;\n        }\n        // Extract styles from style tags\n        const styles = Array.from(doc.querySelectorAll('style'))\n            .map(style => style.textContent)\n            .join('\\n');\n        // Extract scripts from script tags\n        const scripts = Array.from(doc.querySelectorAll('script'))\n            .map(script => script.textContent)\n            .join('\\n');\n        // Create a complete HTML document\n        const fullHtml = `<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <style>${styles}</style>\n</head>\n<body>\n  ${htmlContent}\n  <script>${scripts}</script>\n</body>\n</html>`;\n        // Create a blob URL from the HTML content\n        const blob = new Blob([fullHtml], { type: 'text/html' });\n        const blobUrl = URL.createObjectURL(blob);\n        // Load the blob URL into the iframe\n        $(`#${SIDEBAR_ID}-iframe`).attr('src', blobUrl);\n        // Save the pasted content\n        const settings = getSettings();\n        saveSettings({ ...settings, pasteContent: code });\n        toastr.success('Code rendered successfully');\n    }\n    catch (error) {\n        console.error('Failed to render pasted code:', error);\n        toastr.error('Failed to render code: ' + (error instanceof Error ? error.message : String(error)));\n    }\n}\nfunction toggleSidebar(show) {\n    sidebarVisible = typeof show === 'boolean' ? show : !sidebarVisible;\n    $(`#${SIDEBAR_ID}`).toggleClass('visible', sidebarVisible);\n}\n// Initialization\n$(() => {\n    injectCSS();\n    injectHTML();\n    const buttonName = 'üåê External Interface';\n    // Register button in Tavern Helper\n    if (typeof replaceScriptButtons === 'function') {\n        replaceScriptButtons([{ name: buttonName, visible: true }]);\n    }\n    // Listen for button click\n    if (typeof getButtonEvent === 'function') {\n        const eventName = getButtonEvent(buttonName);\n        eventOn(eventName, () => toggleSidebar());\n    }\n    // Handle global escape to close\n    $(document).on('keydown', e => {\n        if (e.key === 'Escape' && sidebarVisible) {\n            toggleSidebar(false);\n        }\n    });\n});\n// Cleanup\n$(window).on('pagehide', () => {\n    $(`#${SIDEBAR_ID}`).remove();\n    deteleportStyle();\n});\n","export async function loadReadme(url: string): Promise<boolean> {\n  const readme = await fetch(url);\n  if (!readme.ok) {\n    return false;\n  }\n  const readme_text = await readme.text();\n  replaceScriptInfo(readme_text);\n  return true;\n}\n\nexport function teleportStyle() {\n  if ($(`head > div[script_id=\"${getScriptId()}\"]`).length > 0) {\n    return;\n  }\n  const $div = $(`<div>`).attr('script_id', getScriptId()).append($(`head > style`, document).clone());\n  $('head').append($div);\n}\n\nexport function deteleportStyle() {\n  $(`head > div[script_id=\"${getScriptId()}\"]`).remove();\n}\n\nexport function createScriptIdDiv(): JQuery<HTMLDivElement> {\n  return $('<div>').attr('script_id', getScriptId()) as JQuery<HTMLDivElement>;\n}\n\nexport function destroyScriptIdDiv(): void {\n  $(`div[script_id=\"${getScriptId()}\"]`).remove();\n}\n\nexport function reloadOnChatChange(): EventOnReturn {\n  let chat_id = SillyTavern.getCurrentChatId();\n  return eventOn(tavern_events.CHAT_CHANGED, new_chat_id => {\n    if (chat_id !== new_chat_id) {\n      chat_id = new_chat_id;\n      window.location.reload();\n    }\n  });\n}\n"],"names":["z","SIDEBAR_ID","SettingsSchema","object","mode","enum","default","url","string","min","pasteContent","sidebarVisible","getSettings","vars","getVariables","type","parse","e","saveSettings","settings","replaceVariables","injectCSS","css","$","text","appendTo","getScriptId","length","$div","attr","append","document","clone","teleportStyle","injectHTML","html","on","toggleSidebar","newMode","removeClass","addClass","toggleClass","toastr","info","switchMode","this","data","val","trim","updateUrl","which","code","renderPastedCode","startsWith","includes","success","error","doc","DOMParser","parseFromString","htmlContent","body","innerHTML","documentElement","outerHTML","styles","Array","from","querySelectorAll","map","style","textContent","join","fullHtml","script","blob","Blob","blobUrl","URL","createObjectURL","console","Error","message","String","show","buttonName","replaceScriptButtons","name","visible","getButtonEvent","eventName","eventOn","key","window","remove"],"ignoreList":[],"sourceRoot":""}