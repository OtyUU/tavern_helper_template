{"version":3,"file":"index.js","mappings":"AAAA,MAAM,EAA+BA,ECC/BC,EAAa,sCAGbC,EAAiB,EAAAF,EAAEG,OAAO,CAC5BC,IAAK,EAAAJ,EAAEK,SAASD,MAAME,GAAG,EAAAN,EAAEO,QAAQ,gBAAgBC,QAAQ,iBAE/D,IAAIC,GAAiB,EAarB,SAASC,IACL,MAAMC,EAAM,UACTV,2qBAqBAA,+DAIAA,iUAYAA,oGAMAA,gUAYAA,qGAKAA,mGAMAA,2HAOAA,qNASAA,oQAWAA,8OAWAA,6DAIHW,EAAE,WAAWC,KAAKF,GAAKG,SAAS,QCxH7B,WACL,GAAIF,EAAE,yBAAyBG,mBAAmBC,OAAS,EACzD,OAEF,MAAMC,EAAOL,EAAE,SAASM,KAAK,YAAaH,eAAeI,OAAOP,EAAE,eAAgBQ,UAAUC,SAC5FT,EAAE,QAAQO,OAAOF,EACnB,CDmHIK,EACJ,CACA,SAASC,IACL,GAAIX,EAAE,IAAIX,KAAce,OAAS,EAC7B,OACJ,MAAMQ,EAhIV,WACI,IACI,MAAMC,EAAOC,aAAa,CAAEC,KAAM,WAClC,OAAOzB,EAAe0B,MAAMH,EAChC,CACA,MAAOI,GACH,OAAO3B,EAAe0B,MAAM,CAAC,EACjC,CACJ,CAwHqBE,GACXC,EAAO,kBACF9B,0PAMyBA,qGAGlBA,kBAA2BuB,EAASpB,8GAGPH,uBAAiD,gBAAjBuB,EAASpB,IAAwB,GAAKoB,EAASpB,+EAC3FH,0DAInCW,EAAE,QAAQO,OAAOY,GACjBnB,EAAE,IAAIX,WAAoB+B,GAAG,QAAS,IAAMC,GAAc,IAC1DrB,EAAE,IAAIX,cAAuB+B,GAAG,QAAS,KACrC,MAAM5B,EAAMQ,EAAE,IAAIX,eAAwBiC,MAAMC,OAC5C/B,GACAgC,EAAUhC,KAIlBQ,EAAE,IAAIX,eAAwB+B,GAAG,WAAYH,IACzC,GAAgB,KAAZA,EAAEQ,MAAc,CAChB,MAAMjC,EAAMQ,EAAE,IAAIX,eAAwBiC,MAAMC,OAC5C/B,GACAgC,EAAUhC,EAClB,GAER,CACA,SAASgC,EAAUhC,GACf,IAESA,EAAIkC,WAAW,YAAelC,EAAIkC,WAAW,aAAuB,gBAARlC,IAC7DA,EAAM,WAAaA,GAEvBF,EAAe0B,MAAM,CAAExB,QACvBQ,EAAE,IAAIX,YAAqBiB,KAAK,MAAOd,GAjK3CmC,iBAkKiB,CAAEnC,OAlKQ,CAAEuB,KAAM,WAmK/Ba,OAAOC,QAAQ,yBACnB,CACA,MAAOZ,GACHW,OAAOE,MAAM,qBACjB,CACJ,CACA,SAAST,EAAcU,GACnBlC,EAAiC,kBAATkC,EAAqBA,GAAQlC,EACrDG,EAAE,IAAIX,KAAc2C,YAAY,UAAWnC,EAC/C,CAEAG,EAAE,KACEF,IACAa,IACA,MAAMsB,EAAa,wBAMnB,GAJoC,mBAAzBC,sBACPA,qBAAqB,CAAC,CAAEC,KAAMF,EAAYG,SAAS,KAGzB,mBAAnBC,eAA+B,CACtC,MAAMC,EAAYD,eAAeJ,GACjCM,QAAQD,EAAW,IAAMjB,IAC7B,CAEArB,EAAEQ,UAAUY,GAAG,UAAWH,IACR,WAAVA,EAAEuB,KAAoB3C,GACtBwB,GAAc,OAK1BrB,EAAEyC,QAAQrB,GAAG,WAAY,KACrBpB,EAAE,IAAIX,KAAcqD,SCnMtB1C,EAAE,yBAAyBG,mBAAmBuC","sources":["src://tavern_helper_template/external var \"z\"","src://tavern_helper_template/src/external-html-sidebar/index.ts","src://tavern_helper_template/src/util/script.ts"],"sourcesContent":["const __WEBPACK_NAMESPACE_OBJECT__ = z;","import { deteleportStyle, teleportStyle } from '../util/script';\nconst SIDEBAR_ID = 'tavern-helper-external-html-sidebar';\nconst SIDEBAR_WIDTH = '500px';\n// Zod schema for settings\nconst SettingsSchema = z.object({\n    url: z.string().url().or(z.literal('about:blank')).default('about:blank'),\n});\nlet sidebarVisible = false;\nfunction getSettings() {\n    try {\n        const vars = getVariables({ type: 'script' });\n        return SettingsSchema.parse(vars);\n    }\n    catch (e) {\n        return SettingsSchema.parse({});\n    }\n}\nfunction saveSettings(settings) {\n    replaceVariables(settings, { type: 'script' });\n}\nfunction injectCSS() {\n    const css = `\n    #${SIDEBAR_ID} {\n      position: fixed;\n      top: 0;\n      right: 0;\n      width: ${SIDEBAR_WIDTH};\n      height: 100vh;\n      background: rgba(29, 33, 40, 0.95);\n      backdrop-filter: blur(5px);\n      border-left: 0.5px solid rgba(0, 0, 0, 0.5);\n      border-top-left-radius: 12px;\n      border-bottom-left-radius: 12px;\n      z-index: 999999;\n      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n      transform: translateX(100%);\n      display: flex;\n      flex-direction: column;\n      color: rgba(207, 207, 197, 1);\n      box-shadow: -2px 0 10px rgba(0, 0, 0, 0.5);\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;\n    }\n\n    #${SIDEBAR_ID}.visible {\n      transform: translateX(0);\n    }\n\n    #${SIDEBAR_ID} .header {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      padding: 0 20px;\n      height: 50px;\n      background: rgba(29, 33, 40, 0.98);\n      border-bottom: 0.5px solid rgba(0, 0, 0, 0.8);\n      border-top-left-radius: 12px;\n      flex-shrink: 0;\n    }\n\n    #${SIDEBAR_ID} .header h3 {\n      margin: 0;\n      font-size: 16px;\n      font-weight: 500;\n    }\n\n    #${SIDEBAR_ID} .close-btn {\n      background: rgba(29, 33, 40, 0.6);\n      border: 0.5px solid rgba(0, 0, 0, 0.8);\n      color: rgba(207, 207, 197, 0.9);\n      cursor: pointer;\n      padding: 5px 12px;\n      border-radius: 8px;\n      font-size: 20px;\n      transition: all 0.2s ease;\n      line-height: 1;\n    }\n\n    #${SIDEBAR_ID} .close-btn:hover {\n      background: rgba(40, 45, 52, 0.8);\n      color: #fff;\n    }\n\n    #${SIDEBAR_ID} .content {\n      flex: 1;\n      overflow: hidden;\n      position: relative;\n    }\n\n    #${SIDEBAR_ID} iframe {\n      width: 100%;\n      height: 100%;\n      border: none;\n      background: transparent;\n    }\n\n    #${SIDEBAR_ID} .footer {\n      padding: 10px 15px;\n      background: rgba(29, 33, 40, 0.98);\n      border-top: 0.5px solid rgba(0, 0, 0, 0.8);\n      display: flex;\n      gap: 8px;\n      flex-shrink: 0;\n    }\n\n    #${SIDEBAR_ID} .url-input {\n      flex: 1;\n      background: rgba(0, 0, 0, 0.3);\n      border: 0.5px solid rgba(255, 255, 255, 0.1);\n      border-radius: 6px;\n      color: #fff;\n      padding: 6px 10px;\n      font-size: 12px;\n      outline: none;\n    }\n\n    #${SIDEBAR_ID} .load-btn {\n      background: #4a5568;\n      border: none;\n      border-radius: 6px;\n      color: #fff;\n      padding: 6px 12px;\n      font-size: 12px;\n      cursor: pointer;\n      transition: background 0.2s;\n    }\n\n    #${SIDEBAR_ID} .load-btn:hover {\n      background: #2d3748;\n    }\n  `;\n    $('<style>').text(css).appendTo('head');\n    teleportStyle();\n}\nfunction injectHTML() {\n    if ($(`#${SIDEBAR_ID}`).length > 0)\n        return;\n    const settings = getSettings();\n    const html = `\n    <div id=\"${SIDEBAR_ID}\">\n      <div class=\"header\">\n        <div style=\"display: flex; align-items: center; gap: 8px;\">\n          <span style=\"font-size: 18px;\">üåê</span>\n          <h3>External Interface</h3>\n        </div>\n        <button class=\"close-btn\" id=\"${SIDEBAR_ID}-close\" title=\"Close\">√ó</button>\n      </div>\n      <div class=\"content\">\n        <iframe id=\"${SIDEBAR_ID}-iframe\" src=\"${settings.url}\"></iframe>\n      </div>\n      <div class=\"footer\">\n        <input type=\"text\" class=\"url-input\" id=\"${SIDEBAR_ID}-url-input\" value=\"${settings.url === 'about:blank' ? '' : settings.url}\" placeholder=\"Enter HTML URL...\">\n        <button class=\"load-btn\" id=\"${SIDEBAR_ID}-load-btn\">Load</button>\n      </div>\n    </div>\n  `;\n    $('body').append(html);\n    $(`#${SIDEBAR_ID}-close`).on('click', () => toggleSidebar(false));\n    $(`#${SIDEBAR_ID}-load-btn`).on('click', () => {\n        const url = $(`#${SIDEBAR_ID}-url-input`).val().trim();\n        if (url) {\n            updateUrl(url);\n        }\n    });\n    // Handle Enter key in input\n    $(`#${SIDEBAR_ID}-url-input`).on('keypress', e => {\n        if (e.which === 13) {\n            const url = $(`#${SIDEBAR_ID}-url-input`).val().trim();\n            if (url)\n                updateUrl(url);\n        }\n    });\n}\nfunction updateUrl(url) {\n    try {\n        // Add protocol if missing\n        if (!url.startsWith('http://') && !url.startsWith('https://') && url !== 'about:blank') {\n            url = 'https://' + url;\n        }\n        SettingsSchema.parse({ url });\n        $(`#${SIDEBAR_ID}-iframe`).attr('src', url);\n        saveSettings({ url });\n        toastr.success('URL updated and loaded');\n    }\n    catch (e) {\n        toastr.error('Invalid URL format');\n    }\n}\nfunction toggleSidebar(show) {\n    sidebarVisible = typeof show === 'boolean' ? show : !sidebarVisible;\n    $(`#${SIDEBAR_ID}`).toggleClass('visible', sidebarVisible);\n}\n// Initialization\n$(() => {\n    injectCSS();\n    injectHTML();\n    const buttonName = 'üåê External Interface';\n    // Register button in Tavern Helper\n    if (typeof replaceScriptButtons === 'function') {\n        replaceScriptButtons([{ name: buttonName, visible: true }]);\n    }\n    // Listen for button click\n    if (typeof getButtonEvent === 'function') {\n        const eventName = getButtonEvent(buttonName);\n        eventOn(eventName, () => toggleSidebar());\n    }\n    // Handle global escape to close\n    $(document).on('keydown', e => {\n        if (e.key === 'Escape' && sidebarVisible) {\n            toggleSidebar(false);\n        }\n    });\n});\n// Cleanup\n$(window).on('pagehide', () => {\n    $(`#${SIDEBAR_ID}`).remove();\n    deteleportStyle();\n});\n","export async function loadReadme(url: string): Promise<boolean> {\n  const readme = await fetch(url);\n  if (!readme.ok) {\n    return false;\n  }\n  const readme_text = await readme.text();\n  replaceScriptInfo(readme_text);\n  return true;\n}\n\nexport function teleportStyle() {\n  if ($(`head > div[script_id=\"${getScriptId()}\"]`).length > 0) {\n    return;\n  }\n  const $div = $(`<div>`).attr('script_id', getScriptId()).append($(`head > style`, document).clone());\n  $('head').append($div);\n}\n\nexport function deteleportStyle() {\n  $(`head > div[script_id=\"${getScriptId()}\"]`).remove();\n}\n\nexport function createScriptIdDiv(): JQuery<HTMLDivElement> {\n  return $('<div>').attr('script_id', getScriptId()) as JQuery<HTMLDivElement>;\n}\n\nexport function destroyScriptIdDiv(): void {\n  $(`div[script_id=\"${getScriptId()}\"]`).remove();\n}\n\nexport function reloadOnChatChange(): EventOnReturn {\n  let chat_id = SillyTavern.getCurrentChatId();\n  return eventOn(tavern_events.CHAT_CHANGED, new_chat_id => {\n    if (chat_id !== new_chat_id) {\n      chat_id = new_chat_id;\n      window.location.reload();\n    }\n  });\n}\n"],"names":["z","SIDEBAR_ID","SettingsSchema","object","url","string","or","literal","default","sidebarVisible","injectCSS","css","$","text","appendTo","getScriptId","length","$div","attr","append","document","clone","teleportStyle","injectHTML","settings","vars","getVariables","type","parse","e","getSettings","html","on","toggleSidebar","val","trim","updateUrl","which","startsWith","replaceVariables","toastr","success","error","show","toggleClass","buttonName","replaceScriptButtons","name","visible","getButtonEvent","eventName","eventOn","key","window","remove"],"ignoreList":[],"sourceRoot":""}