{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/external var \"z\"","src://tavern_helper_template/src/external-html-sidebar/index.ts","src://tavern_helper_template/src/util/script.ts"],"sourcesContent":["const __WEBPACK_NAMESPACE_OBJECT__ = z;","import { deteleportStyle, teleportStyle } from '../util/script';\nimport jquerySource from 'jquery/dist/jquery.min.js?raw';\nimport lodashSource from 'lodash/lodash.min.js?raw';\nconst SIDEBAR_ID = 'tavern-helper-external-html-sidebar';\nconst SIDEBAR_WIDTH = '500px';\n// Zod schema for settings\nconst SettingsSchema = z.object({\n    mode: z.enum(['url', 'paste']).default('url'),\n    url: z.string().min(1).default('about:blank'),\n    pasteContent: z.string().default(''),\n});\nconst HOST_BRIDGE_KEY = '__tavern_helper_external_html_sidebar_bridge__';\nlet sidebarVisible = false;\nlet currentBlobUrl = null;\nfunction installHostBridge() {\n    try {\n        if (!window.parent)\n            return;\n        window.parent[HOST_BRIDGE_KEY] = {\n            getGlobal: (name) => globalThis[name],\n            getCurrentMessageId: () => {\n                const getLastMessageId = globalThis.getLastMessageId;\n                if (typeof getLastMessageId === 'function')\n                    return getLastMessageId();\n                const chat = globalThis.SillyTavern?.chat;\n                if (Array.isArray(chat))\n                    return Math.max(0, chat.length - 1);\n                return 0;\n            },\n        };\n    }\n    catch {\n        // ignore\n    }\n}\nfunction escapeInlineScript(source) {\n    return source.replaceAll('</script', '<\\\\/script');\n}\nfunction setSidebarIframeSrc(src) {\n    if (currentBlobUrl) {\n        URL.revokeObjectURL(currentBlobUrl);\n        currentBlobUrl = null;\n    }\n    if (src.startsWith('blob:')) {\n        currentBlobUrl = src;\n    }\n    $(`#${SIDEBAR_ID}-iframe`).attr('src', src);\n}\nfunction buildRuntimeWrappedHtml(html) {\n    const parser = new DOMParser();\n    const doc = parser.parseFromString(html, 'text/html');\n    if (!doc.head) {\n        const head = doc.createElement('head');\n        doc.documentElement.insertBefore(head, doc.body);\n    }\n    if (!doc.head.querySelector('meta[charset]')) {\n        const meta = doc.createElement('meta');\n        meta.setAttribute('charset', 'UTF-8');\n        doc.head.prepend(meta);\n    }\n    const runtimeShim = `\n(() => {\n  const BRIDGE_KEY = ${JSON.stringify(HOST_BRIDGE_KEY)};\n  const bridge = (() => {\n    try {\n      return window.parent && window.parent[BRIDGE_KEY];\n    } catch {\n      return undefined;\n    }\n  })();\n\n  const missing = name => () => {\n    throw new Error(\n      '[external-html-sidebar] Missing runtime global: ' +\n        name +\n        '. This page must be rendered inside SillyTavern with Tavern Helper + external-html-sidebar.',\n    );\n  };\n\n  const getGlobal = name => (bridge && bridge.getGlobal ? bridge.getGlobal(name) : undefined);\n\n  const bridgeFn = name => (...args) => {\n    const fn = getGlobal(name);\n    if (typeof fn !== 'function') return missing(name)();\n    return fn(...args);\n  };\n\n  const syncGlobal = name => {\n    try {\n      const value = getGlobal(name);\n      if (typeof value !== 'undefined' && typeof window[name] === 'undefined') {\n        window[name] = value;\n      }\n    } catch {\n      // ignore\n    }\n  };\n\n  if (typeof window.waitGlobalInitialized !== 'function') {\n    window.waitGlobalInitialized = async name => {\n      await bridgeFn('waitGlobalInitialized')(name);\n      syncGlobal(name);\n    };\n  }\n  if (typeof window.getAllVariables !== 'function') window.getAllVariables = bridgeFn('getAllVariables');\n  if (typeof window.getVariables !== 'function') window.getVariables = bridgeFn('getVariables');\n  if (typeof window.replaceVariables !== 'function') window.replaceVariables = bridgeFn('replaceVariables');\n  if (typeof window.triggerSlash !== 'function') window.triggerSlash = bridgeFn('triggerSlash');\n  if (typeof window.eventOn !== 'function') window.eventOn = bridgeFn('eventOn');\n  if (typeof window.getButtonEvent !== 'function') window.getButtonEvent = bridgeFn('getButtonEvent');\n  if (typeof window.replaceScriptButtons !== 'function') window.replaceScriptButtons = bridgeFn('replaceScriptButtons');\n\n  if (typeof window.errorCatched !== 'function') {\n    window.errorCatched = fn => (...args) => {\n      try {\n        const result = fn(...args);\n        if (result && typeof result.then === 'function') {\n          return result.catch(err => {\n            console.error(err);\n            throw err;\n          });\n        }\n        return result;\n      } catch (err) {\n        console.error(err);\n        throw err;\n      }\n    };\n  }\n\n  syncGlobal('SillyTavern');\n  syncGlobal('toastr');\n  syncGlobal('Mvu');\n  syncGlobal('tavern_events');\n  syncGlobal('z');\n  syncGlobal('gsap');\n  syncGlobal('YAML');\n\n  if (typeof window.getCurrentMessageId !== 'function') {\n    window.getCurrentMessageId = () => {\n      try {\n        if (bridge && typeof bridge.getCurrentMessageId === 'function') {\n          return bridge.getCurrentMessageId();\n        }\n      } catch {\n        // ignore\n      }\n\n      try {\n        const chat = window.SillyTavern && window.SillyTavern.chat;\n        if (Array.isArray(chat)) return Math.max(0, chat.length - 1);\n      } catch {\n        // ignore\n      }\n\n      return 0;\n    };\n  }\n})();\n`;\n    const scriptJquery = doc.createElement('script');\n    scriptJquery.textContent = escapeInlineScript(jquerySource);\n    const scriptLodash = doc.createElement('script');\n    scriptLodash.textContent = escapeInlineScript(lodashSource);\n    const scriptShim = doc.createElement('script');\n    scriptShim.textContent = escapeInlineScript(runtimeShim);\n    doc.head.prepend(scriptJquery, scriptLodash, scriptShim);\n    return `<!DOCTYPE html>\\n${doc.documentElement.outerHTML}`;\n}\nfunction getSettings() {\n    try {\n        const vars = getVariables({ type: 'script' });\n        return SettingsSchema.parse(vars);\n    }\n    catch (e) {\n        return SettingsSchema.parse({});\n    }\n}\nfunction saveSettings(settings) {\n    replaceVariables(settings, { type: 'script' });\n}\nfunction injectCSS() {\n    const css = `\n    #${SIDEBAR_ID} {\n      position: fixed;\n      top: 0;\n      right: 0;\n      width: ${SIDEBAR_WIDTH};\n      height: 100vh;\n      background: rgba(29, 33, 40, 0.95);\n      backdrop-filter: blur(5px);\n      border-left: 0.5px solid rgba(0, 0, 0, 0.5);\n      border-top-left-radius: 12px;\n      border-bottom-left-radius: 12px;\n      z-index: 999999;\n      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n      transform: translateX(100%);\n      display: flex;\n      flex-direction: column;\n      color: rgba(207, 207, 197, 1);\n      box-shadow: -2px 0 10px rgba(0, 0, 0, 0.5);\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;\n    }\n\n    #${SIDEBAR_ID}.visible {\n      transform: translateX(0);\n    }\n\n    #${SIDEBAR_ID} .header {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      padding: 0 20px;\n      height: 50px;\n      background: rgba(29, 33, 40, 0.98);\n      border-bottom: 0.5px solid rgba(0, 0, 0, 0.8);\n      border-top-left-radius: 12px;\n      flex-shrink: 0;\n    }\n\n    #${SIDEBAR_ID} .header h3 {\n      margin: 0;\n      font-size: 16px;\n      font-weight: 500;\n    }\n\n    #${SIDEBAR_ID} .close-btn {\n      background: rgba(29, 33, 40, 0.6);\n      border: 0.5px solid rgba(0, 0, 0, 0.8);\n      color: rgba(207, 207, 197, 0.9);\n      cursor: pointer;\n      padding: 5px 12px;\n      border-radius: 8px;\n      font-size: 20px;\n      transition: all 0.2s ease;\n      line-height: 1;\n    }\n\n    #${SIDEBAR_ID} .close-btn:hover {\n      background: rgba(40, 45, 52, 0.8);\n      color: #fff;\n    }\n\n    #${SIDEBAR_ID} .content {\n      flex: 1;\n      overflow: hidden;\n      position: relative;\n    }\n\n    #${SIDEBAR_ID} iframe {\n      width: 100%;\n      height: 100%;\n      border: none;\n      background: transparent;\n    }\n\n    #${SIDEBAR_ID} .footer {\n      padding: 10px 15px;\n      background: rgba(29, 33, 40, 0.98);\n      border-top: 0.5px solid rgba(0, 0, 0, 0.8);\n      display: flex;\n      gap: 8px;\n      flex-shrink: 0;\n    }\n\n    #${SIDEBAR_ID} .url-input {\n      flex: 1;\n      background: rgba(0, 0, 0, 0.3);\n      border: 0.5px solid rgba(255, 255, 255, 0.1);\n      border-radius: 6px;\n      color: #fff;\n      padding: 6px 10px;\n      font-size: 12px;\n      outline: none;\n    }\n\n    #${SIDEBAR_ID} .load-btn {\n      background: #4a5568;\n      border: none;\n      border-radius: 6px;\n      color: #fff;\n      padding: 6px 12px;\n      font-size: 12px;\n      cursor: pointer;\n      transition: background 0.2s;\n    }\n\n    #${SIDEBAR_ID} .load-btn:hover {\n      background: #2d3748;\n    }\n\n    #${SIDEBAR_ID} .mode-toggle {\n      display: flex;\n      background: rgba(0, 0, 0, 0.3);\n      border-radius: 6px;\n      padding: 2px;\n      margin-bottom: 8px;\n    }\n\n    #${SIDEBAR_ID} .mode-option {\n      flex: 1;\n      background: transparent;\n      border: none;\n      color: #aaa;\n      padding: 6px 12px;\n      border-radius: 4px;\n      font-size: 12px;\n      cursor: pointer;\n      transition: all 0.2s;\n    }\n\n    #${SIDEBAR_ID} .mode-option.active {\n      background: #4a5568;\n      color: #fff;\n    }\n\n    #${SIDEBAR_ID} .mode-content {\n      display: flex;\n      flex-direction: column;\n      gap: 8px;\n      flex: 1;\n    }\n\n    #${SIDEBAR_ID} .paste-container {\n      display: none;\n      flex-direction: column;\n      gap: 8px;\n    }\n\n    #${SIDEBAR_ID} .paste-container.active {\n      display: flex;\n    }\n\n    #${SIDEBAR_ID} .url-container {\n      display: none;\n      gap: 8px;\n    }\n\n    #${SIDEBAR_ID} .url-container.active {\n      display: flex;\n    }\n\n    #${SIDEBAR_ID} .paste-textarea {\n      flex: 1;\n      background: rgba(0, 0, 0, 0.3);\n      border: 0.5px solid rgba(255, 255, 255, 0.1);\n      border-radius: 6px;\n      color: #fff;\n      padding: 8px;\n      font-size: 12px;\n      font-family: 'Courier New', monospace;\n      resize: vertical;\n      min-height: 60px;\n      outline: none;\n    }\n\n    #${SIDEBAR_ID} .paste-textarea:focus {\n      border-color: #4a5568;\n    }\n\n    #${SIDEBAR_ID} .render-btn {\n      background: #4a5568;\n      border: none;\n      border-radius: 6px;\n      color: #fff;\n      padding: 6px 12px;\n      font-size: 12px;\n      cursor: pointer;\n      transition: background 0.2s;\n    }\n\n    #${SIDEBAR_ID} .render-btn:hover {\n      background: #2d3748;\n    }\n  `;\n    $('<style>').text(css).appendTo('head');\n    teleportStyle();\n}\nfunction injectHTML() {\n    if ($(`#${SIDEBAR_ID}`).length > 0)\n        return;\n    const settings = getSettings();\n    const mode = settings.mode || 'url';\n    const html = `\n    <div id=\"${SIDEBAR_ID}\">\n      <div class=\"header\">\n        <div style=\"display: flex; align-items: center; gap: 8px;\">\n          <span style=\"font-size: 18px;\">üåê</span>\n          <h3>External Interface</h3>\n        </div>\n        <button class=\"close-btn\" id=\"${SIDEBAR_ID}-close\" title=\"Close\">√ó</button>\n      </div>\n      <div class=\"content\">\n        <iframe id=\"${SIDEBAR_ID}-iframe\" src=\"${settings.url}\"></iframe>\n      </div>\n      <div class=\"footer\">\n        <div class=\"mode-toggle\">\n          <button class=\"mode-option ${mode === 'url' ? 'active' : ''}\" data-mode=\"url\">URL</button>\n          <button class=\"mode-option ${mode === 'paste' ? 'active' : ''}\" data-mode=\"paste\">Paste Code</button>\n        </div>\n        <div class=\"mode-content\">\n          <div class=\"url-container ${mode === 'url' ? 'active' : ''}\">\n            <input type=\"text\" class=\"url-input\" id=\"${SIDEBAR_ID}-url-input\" value=\"${settings.url === 'about:blank' ? '' : settings.url}\" placeholder=\"Enter HTML URL (e.g. ./panel/index.html)...\">\n            <button class=\"load-btn\" id=\"${SIDEBAR_ID}-load-btn\">Load</button>\n          </div>\n          <div class=\"paste-container ${mode === 'paste' ? 'active' : ''}\">\n            <textarea class=\"paste-textarea\" id=\"${SIDEBAR_ID}-paste-textarea\" placeholder=\"Paste your HTML/CSS/JS code here...\">${settings.pasteContent}</textarea>\n            <button class=\"render-btn\" id=\"${SIDEBAR_ID}-render-btn\">Render</button>\n          </div>\n        </div>\n      </div>\n    </div>\n  `;\n    $('body').append(html);\n    $(`#${SIDEBAR_ID}-close`).on('click', () => toggleSidebar(false));\n    // Mode toggle functionality\n    $(`.mode-option`).on('click', function () {\n        const selectedMode = $(this).data('mode');\n        switchMode(selectedMode);\n    });\n    // URL mode functionality\n    $(`#${SIDEBAR_ID}-load-btn`).on('click', () => {\n        const url = $(`#${SIDEBAR_ID}-url-input`).val().trim();\n        if (url) {\n            updateUrl(url);\n        }\n    });\n    $(`#${SIDEBAR_ID}-url-input`).on('keypress', e => {\n        if (e.which === 13) {\n            const url = $(`#${SIDEBAR_ID}-url-input`).val().trim();\n            if (url)\n                updateUrl(url);\n        }\n    });\n    // Paste mode functionality\n    $(`#${SIDEBAR_ID}-render-btn`).on('click', () => {\n        const code = $(`#${SIDEBAR_ID}-paste-textarea`).val();\n        if (code.trim()) {\n            renderPastedCode(code);\n        }\n    });\n    $(`#${SIDEBAR_ID}-paste-textarea`).on('input', () => {\n        const code = $(`#${SIDEBAR_ID}-paste-textarea`).val();\n        saveSettings({ ...getSettings(), pasteContent: code });\n    });\n    // Initialize based on current mode\n    if (mode === 'paste' && settings.pasteContent) {\n        renderPastedCode(settings.pasteContent);\n    }\n}\nfunction updateUrl(url) {\n    try {\n        // Add protocol if missing and it looks like a domain\n        if (!url.startsWith('http://') &&\n            !url.startsWith('https://') &&\n            !url.startsWith('./') &&\n            !url.startsWith('/') &&\n            url !== 'about:blank') {\n            if (url.includes('.') && !url.includes(' ')) {\n                url = 'https://' + url;\n            }\n        }\n        SettingsSchema.parse({ url });\n        setSidebarIframeSrc(url);\n        saveSettings({ ...getSettings(), url });\n        toastr.success('URL updated and loaded');\n    }\n    catch {\n        toastr.error('Invalid URL format');\n    }\n}\nfunction switchMode(newMode) {\n    const settings = getSettings();\n    saveSettings({ ...settings, mode: newMode });\n    // Update UI\n    $('.mode-option').removeClass('active');\n    $(`.mode-option[data-mode=\"${newMode}\"]`).addClass('active');\n    $('.url-container').toggleClass('active', newMode === 'url');\n    $('.paste-container').toggleClass('active', newMode === 'paste');\n    toastr.info(`Switched to ${newMode} mode`);\n}\nfunction renderPastedCode(code) {\n    try {\n        const fullHtml = buildRuntimeWrappedHtml(code);\n        const blob = new Blob([fullHtml], { type: 'text/html' });\n        const blobUrl = URL.createObjectURL(blob);\n        setSidebarIframeSrc(blobUrl);\n        saveSettings({ ...getSettings(), pasteContent: code });\n        toastr.success('Code rendered (Tavern Helper runtime shims enabled)');\n    }\n    catch (error) {\n        console.error('Failed to render pasted code:', error);\n        toastr.error('Failed to render code: ' + (error instanceof Error ? error.message : String(error)));\n    }\n}\nfunction toggleSidebar(show) {\n    sidebarVisible = typeof show === 'boolean' ? show : !sidebarVisible;\n    $(`#${SIDEBAR_ID}`).toggleClass('visible', sidebarVisible);\n}\n// Initialization\n$(() => {\n    installHostBridge();\n    injectCSS();\n    injectHTML();\n    const buttonName = 'üåê External Interface';\n    // Register button in Tavern Helper\n    if (typeof replaceScriptButtons === 'function') {\n        replaceScriptButtons([{ name: buttonName, visible: true }]);\n    }\n    // Listen for button click\n    if (typeof getButtonEvent === 'function') {\n        const eventName = getButtonEvent(buttonName);\n        eventOn(eventName, () => toggleSidebar());\n    }\n    // Handle global escape to close\n    $(document).on('keydown', e => {\n        if (e.key === 'Escape' && sidebarVisible) {\n            toggleSidebar(false);\n        }\n    });\n});\n// Cleanup\n$(window).on('pagehide', () => {\n    $(`#${SIDEBAR_ID}`).remove();\n    deteleportStyle();\n    if (currentBlobUrl) {\n        URL.revokeObjectURL(currentBlobUrl);\n        currentBlobUrl = null;\n    }\n    try {\n        delete window.parent[HOST_BRIDGE_KEY];\n    }\n    catch {\n        // ignore\n    }\n});\n","export async function loadReadme(url: string): Promise<boolean> {\n  const readme = await fetch(url);\n  if (!readme.ok) {\n    return false;\n  }\n  const readme_text = await readme.text();\n  replaceScriptInfo(readme_text);\n  return true;\n}\n\nexport function teleportStyle() {\n  if ($(`head > div[script_id=\"${getScriptId()}\"]`).length > 0) {\n    return;\n  }\n  const $div = $(`<div>`).attr('script_id', getScriptId()).append($(`head > style`, document).clone());\n  $('head').append($div);\n}\n\nexport function deteleportStyle() {\n  $(`head > div[script_id=\"${getScriptId()}\"]`).remove();\n}\n\nexport function createScriptIdDiv(): JQuery<HTMLDivElement> {\n  return $('<div>').attr('script_id', getScriptId()) as JQuery<HTMLDivElement>;\n}\n\nexport function destroyScriptIdDiv(): void {\n  $(`div[script_id=\"${getScriptId()}\"]`).remove();\n}\n\nexport function reloadOnChatChange(): EventOnReturn {\n  let chat_id = SillyTavern.getCurrentChatId();\n  return eventOn(tavern_events.CHAT_CHANGED, new_chat_id => {\n    if (chat_id !== new_chat_id) {\n      chat_id = new_chat_id;\n      window.location.reload();\n    }\n  });\n}\n"],"names":["z","SIDEBAR_ID","SettingsSchema","object","mode","enum","default","url","string","min","pasteContent","HOST_BRIDGE_KEY","sidebarVisible","currentBlobUrl","escapeInlineScript","source","replaceAll","setSidebarIframeSrc","src","URL","revokeObjectURL","startsWith","$","attr","getSettings","vars","getVariables","type","parse","e","saveSettings","settings","replaceVariables","injectCSS","css","text","appendTo","getScriptId","length","$div","append","document","clone","teleportStyle","injectHTML","html","on","toggleSidebar","newMode","removeClass","addClass","toggleClass","toastr","info","switchMode","this","data","val","trim","updateUrl","which","code","renderPastedCode","includes","success","error","fullHtml","doc","DOMParser","parseFromString","head","createElement","documentElement","insertBefore","body","querySelector","meta","setAttribute","prepend","runtimeShim","JSON","stringify","scriptJquery","textContent","scriptLodash","scriptShim","outerHTML","buildRuntimeWrappedHtml","blob","Blob","createObjectURL","console","Error","message","String","show","window","parent","getGlobal","name","globalThis","getCurrentMessageId","getLastMessageId","chat","SillyTavern","Array","isArray","Math","max","installHostBridge","buttonName","replaceScriptButtons","visible","getButtonEvent","eventName","eventOn","key","remove"],"ignoreList":[],"sourceRoot":""}